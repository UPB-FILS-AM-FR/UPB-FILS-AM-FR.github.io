"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[623],{2205:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/procesul_de_compilare-81b7f35e0e3f478577e22db2b3ac9452.jpg"},3205:(e,n,r)=>{r.d(n,{A:()=>l});r(6540);var s=r(7481),i=r(3092),t=r(4848);const l=e=>{let{left:n,right:r}=e;return(0,t.jsxs)("div",{style:{display:"flex",gap:"20px",alignItems:"flex-start"},children:[(0,t.jsxs)("div",{style:{flex:1},children:[(0,t.jsx)(s.o,{remarkPlugins:[i.A],children:n})," "]}),(0,t.jsxs)("div",{style:{flex:1},children:[(0,t.jsx)(s.o,{remarkPlugins:[i.A],children:r})," "]})]})}},6573:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/conectare_buton-1cca6542565f3f068e275c3c0a3b49fa.png"},6758:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/atmega324pins-c8dc52d6a8794d0a4ded4788301bfaa6.png"},7003:(e,n,r)=>{r.d(n,{A:()=>t});r(6540);var s=r(8069),i=r(4848);const t=e=>{let{code:n,language:r="javascript",inline:t=!1}=e;return t?(0,i.jsx)("code",{style:{backgroundColor:"#f5f5f5",padding:"2px 4px",borderRadius:"4px"},children:n}):(0,i.jsx)(s.A,{language:r,children:n})}},7132:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/placuta-53a4f6f26ddb1097302ba7c6fa988f2a.png"},9036:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/avr_bootloader_model-4d2cf809b45926c332eacfb42a34c4e3.jpg"},9294:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>P,contentTitle:()=>f,default:()=>C,frontMatter:()=>b,metadata:()=>s,toc:()=>D});const s=JSON.parse('{"id":"lab00/index","title":"Laboratoire 0 : ATmega324. GPIO","description":"Chapitres utiles de ATmega324P Datasheet","source":"@site/i18n/fr/docusaurus-plugin-content-docs-lab/current/lab00/index.mdx","sourceDirName":"lab00","slug":"/lab00/","permalink":"/fr/lab/lab00/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"labSidebar","previous":{"title":"Info General Labo","permalink":"/fr/lab/"},"next":{"title":"Laboratoire 1 : USART. D\xe9bogage","permalink":"/fr/lab/lab01/"}}');var i=r(4848),t=r(8453),l=r(3205),o=r(7003);const a="\nmacro |= (1 << bit_index)\n",c="\nmacro &= ~(1 << bit_index)\n",d="\nmacro ^= (1 << bit_index)\n",u="\nmacro & (1 << bit_index)\n",h="\nDDRB = 8;               // NOT RECOMMENDED.\nDDRB = (1 << 3);        // Also not recommended, as it hardcodes the pin index.\n",m="\nDDRB |= (1 << PB3);     // RECOMMENDED.\nDDRB |= _BV(PB3);       // RECOMMENDED.\n",p="\nbrew install avrdude\nxcode-select --install\nbrew tap osx-cross/avr\nbrew install avr-gcc\n",x="\n$ avrdude -c arduino -P /dev/ttyUSB0 -b 57600 -p atmega324p -U flash:w:lab0.hex:a\n\nC:/> avrdude -c arduino -P COM12 -b 57600 -p atmega324p -U flash:w:lab0.hex:a\n",j="\n upload_protocol = urclock\n",g="\n#include <avr/io.h>\n#include <util/delay.h>\n\nint main() {\n    /* Set pin 7 of port D as an output. */\n    DDRD |= (1 << PD7);\n\n    while(1) {\n        /* Toggle the state of the pin. */\n        PORTD ^= (1 << PD7);\n        _delay_ms(500);\n    }\n\n    return 0;\n}\n",v="\n# Linux\nPORT ?= /dev/ttyUSB0\n# Windows\n#PORT ?= COM1\n\nall: main.hex\n\nmain.hex: main.elf\n\tavr-objcopy  -j .text -j .data -O ihex $^ $@\n\tavr-size main.elf\n\nmain.elf: main.c\n\tavr-gcc -mmcu=atmega324p -DF_CPU=12000000 -Os -Wall -o $@ $^\n\nupload: main.hex\n\tavrdude -c urclock -P $(PORT) -b 57600 -p atmega324p -D -xnometadata -U flash:w:$<:a\n\nclean:\n\trm -rf main.elf main.hex\n";const b={sidebar_position:2},f="Laboratoire 0 : ATmega324. GPIO",P={},D=[{value:"1. Introduction",id:"1-introduction",level:2},{value:"1.1. Pourquoi ?",id:"11-pourquoi-",level:3},{value:"1.2. Qu&#39;est-ce qu&#39;un microcontr\xf4leur (\xb5C) ?",id:"12-quest-ce-quun-microcontr\xf4leur-\xb5c-",level:3},{value:"1.3. \xb5C dans la nature",id:"13-\xb5c-dans-la-nature",level:3},{value:"1.4. Qu\u2019y a-t-il \xe0 l\u2019int\xe9rieur d\u2019un \xb5C ?",id:"14-quy-a-t-il-\xe0-lint\xe9rieur-dun-\xb5c-",level:3},{value:"2. Micropuce (Atmel) AVR",id:"2-micropuce-atmel-avr",level:2},{value:"2.1. ATmega324P",id:"21-atmega324p",level:3},{value:"2.2. La Carte de development du laboratoire",id:"22-la-carte-de-development-du-laboratoire",level:3},{value:"2.3. Pinout de la carte",id:"23-pinout-de-la-carte",level:3},{value:"3. Mettons-nous au travail",id:"3-mettons-nous-au-travail",level:2},{value:"3.1. Actionneurs et transducteurs (capteurs)",id:"31-actionneurs-et-transducteurs-capteurs",level:3},{value:"3.1.1 LED",id:"311-led",level:4},{value:"3.1.2 Boutons",id:"312-boutons",level:4},{value:"3.3. Registres des E/S",id:"33-registres-des-es",level:3},{value:"3.3.1 Exemple de traitement des sorties",id:"331-exemple-de-traitement-des-sorties",level:4},{value:"3.3.2. Exemple de traitement des entr\xe9es",id:"332-exemple-de-traitement-des-entr\xe9es",level:4},{value:"4. D\xe9velopper des programmes pour AVR",id:"4-d\xe9velopper-des-programmes-pour-avr",level:2},{value:"4.1. D\xe9veloppement et compilation",id:"41-d\xe9veloppement-et-compilation",level:3},{value:"4.2. Programmation du microcontr\xf4leur",id:"42-programmation-du-microcontr\xf4leur",level:3},{value:"4.3. PlatformIO",id:"43-platformio",level:3},{value:"4.4. Bonjour tout le monde (Hello World)",id:"44-bonjour-tout-le-monde-hello-world",level:3},{value:"5. Exercices",id:"5-exercices",level:2},{value:"6. Liens utiles",id:"6-liens-utiles",level:2}];function q(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"laboratoire-0--atmega324-gpio",children:"Laboratoire 0 : ATmega324. GPIO"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Chapitres utiles de"})," ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ww1.microchip.com/downloads/fr/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf",children:"ATmega324P Datasheet"})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Configuration des broches - page 15"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"13",children:["\n",(0,i.jsx)(n.li,{children:"E/S-Ports - page 95"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"1-introduction",children:"1. Introduction"}),"\n",(0,i.jsx)(n.h3,{id:"11-pourquoi-",children:"1.1. Pourquoi ?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Q"}),": Que faisons-nous ici? O\xf9 est ce que nous apprenons utilis\xe9? Est-ce vraiment utile?"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"A"}),': Pour r\xe9pondre bri\xe8vement: "beaucoup", "partout" et "oui"; mais commen\xe7ons par un exemple.']}),"\n",(0,i.jsx)(n.p,{children:"Vous venez de construire un nouveau PC et d'installer un \xe9clairage RVB sur la RAM, les ventilateurs et la coque. Maintenant vient la question: qui \"appuie\" sur les boutons pour que les couleurs apparaissent comme d\xe9finies dans le logiciel? Le CPU devrait-il s'asseoir et g\xe9rer le changement des couleurs? Ce serait un gaspillage de ressources. C'est l\xe0 qu'un microcontr\xf4leur entre en jeu! C'est un processeur plus petit et plus simple avec une t\xe2che bien d\xe9finie au sein du syst\xe8me."}),"\n",(0,i.jsx)(n.h3,{id:"12-quest-ce-quun-microcontr\xf4leur-\xb5c-",children:"1.2. Qu'est-ce qu'un microcontr\xf4leur (\xb5C) ?"}),"\n",(0,i.jsx)(n.p,{children:"TLDR: Un ordinateur dans une puce. Plus pr\xe9cis\xe9ment, il s'agit d'un circuit int\xe9gr\xe9 qui comprend une unit\xe9 de traitement (CPU), une m\xe9moire (RAM volatile, EEPROM non volatile, Flash, ROM) et divers p\xe9riph\xe9riques qui lui permettent de communiquer avec l'environnement externe."}),"\n",(0,i.jsx)(n.h3,{id:"13-\xb5c-dans-la-nature",children:"1.3. \xb5C dans la nature"}),"\n",(0,i.jsx)(n.p,{children:"Nous les trouvons dans divers appareils tels que les t\xe9l\xe9phones, les appareils m\xe9nagers, les satellites, les avions, les usines, etc. Il existe une large gamme de microcontr\xf4leurs disponibles, s\xe9lectionn\xe9s en fonction de l'application, en tenant compte principalement de l'optimisation des co\xfbts et de la consommation d'\xe9nergie pour l'appareil o\xf9 le C sera utilis\xe9."}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Example projects"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"projects",src:r(9716).A+"",width:"1066",height:"395"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.northstarst.com/",children:"[1, 2] - Suivi des oiseaux"})}),"\n",(0,i.jsxs)(n.li,{children:["[[3] - Palm size quad-copter] (",(0,i.jsx)(n.a,{href:"http://www.rcgroups.com/forums/showthread.php?t1335765",children:"http://www.rcgroups.com/forums/showthread.php?t1335765"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"[4] - Robot suiveur de ligne (Tare N' Bar)"}),"\n",(0,i.jsx)(n.li,{children:"[5] - Robot de football (IronFoot)"}),"\n",(0,i.jsx)(n.li,{children:"[6] - Robot sous-marin (R0X1)"}),"\n",(0,i.jsxs)(n.li,{children:["[[7] - Skateboard auto-\xe9quilibrant] (",(0,i.jsx)(n.a,{href:"http://www.instructables.com/id/Easy-build-self-balancing-skateboardrobotsegway-/",children:"http://www.instructables.com/id/Easy-build-self-balancing-skateboardrobotsegway-/"}),")"]}),"\n"]}),(0,i.jsxs)(n.p,{children:["Pour plus d'exemples, vous pouvez commencer \xe0 chercher ici : ",(0,i.jsx)(n.a,{href:"https://www.hackster.io/projects/tags/microcontroller",children:"https://www.hackster.io/projects/tags/microcontroller"})]})]}),"\n",(0,i.jsx)(n.h3,{id:"14-quy-a-t-il-\xe0-lint\xe9rieur-dun-\xb5c-",children:"1.4. Qu\u2019y a-t-il \xe0 l\u2019int\xe9rieur d\u2019un \xb5C ?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Central Processing Unit"})," (P core) avec des architectures de 8, 16, 32 ou 64 bits"]}),"\n",(0,i.jsxs)(n.li,{children:["M\xe9moire de donn\xe9es volatiles (",(0,i.jsx)(n.strong,{children:"RAM"}),") et/ou m\xe9moire non volatile (Flash ou EEPROM)"]}),"\n",(0,i.jsxs)(n.li,{children:["M\xe9moire de programme non volatile (",(0,i.jsx)(n.strong,{children:"Flash"})," ou ",(0,i.jsx)(n.strong,{children:"EEPROM"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Ports d'entr\xe9e-sortie num\xe9riques \xe0 usage g\xe9n\xe9ral (",(0,i.jsx)(n.strong,{children:"GPIO"})," - Sortie d'entr\xe9e \xe0 usage g\xe9n\xe9ral)"]}),"\n",(0,i.jsxs)(n.li,{children:["Interfaces de communication s\xe9rie (",(0,i.jsx)(n.strong,{children:"USART"}),", ",(0,i.jsx)(n.strong,{children:"SPI"}),", ",(0,i.jsx)(n.strong,{children:"I2C"}),", PCM, ",(0,i.jsx)(n.strong,{children:"USB"}),", SDIO, etc.)"]}),"\n",(0,i.jsx)(n.li,{children:"Interfaces Ethernet"}),"\n",(0,i.jsxs)(n.li,{children:["Interfaces pour affichages graphiques (LVDS, ",(0,i.jsx)(n.strong,{children:"HDMI"}),", ou autres protocoles de contr\xf4le LCD d\xe9di\xe9s)"]}),"\n",(0,i.jsx)(n.li,{children:"Minuteurs (internes ou utilis\xe9s pour g\xe9n\xe9rer des signaux p\xe9riodiques - par exemple, PWM - ou comme chien de garde)"}),"\n",(0,i.jsxs)(n.li,{children:["Convertisseurs analogique-num\xe9rique et num\xe9rique-analogique (",(0,i.jsx)(n.strong,{children:"ADC"}),", ",(0,i.jsx)(n.strong,{children:"DAC"}),"), frontaux analogiques et autres circuits pour signaux analogiques"]}),"\n",(0,i.jsx)(n.li,{children:"Source de tension int\xe9gr\xe9e"}),"\n",(0,i.jsx)(n.li,{children:"Interface de programmation et de d\xe9bogage"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Les p\xe9riph\xe9riques"})," repr\xe9sentent tout p\xe9riph\xe9rique interne ou externe qui se connecte \xe0 un syst\xe8me informatique et \xe9tend ses fonctionnalit\xe9s de base. Dans le cas d'un microcontr\xf4leur, plusieurs de ces p\xe9riph\xe9riques sont int\xe9gr\xe9s directement dans la puce (exemples ci-dessus). Bien qu'ils ne ressemblent pas \xe0 des p\xe9riph\xe9riques PC (moniteur, carte graphique, clavier, souris, etc.), sans eux, le microcontr\xf4leur ne serait pas en mesure d'interagir avec le monde ext\xe9rieur."]}),"\n",(0,i.jsx)(n.h2,{id:"2-micropuce-atmel-avr",children:"2. Micropuce (Atmel) AVR"}),"\n",(0,i.jsx)(n.p,{children:"Tout au long du semestre, nous travaillerons avec des microcontr\xf4leurs de la famille AVR de Microchip. Ceux-ci ont une architecture Harvard 8 bits et un jeu d'instructions r\xe9duit (RISC)."}),"\n",(0,i.jsx)(n.h3,{id:"21-atmega324p",children:"2.1. ATmega324P"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"ATmega324P",src:r(9804).A+"",width:"640",height:"640"})}),"\n",(0,i.jsx)(n.p,{children:"Il s'agit d'un microcontr\xf4leur 8 bits de la famille megaAVR, que nous utiliserons tout au long du semestre. Ses registres et son bus de donn\xe9es interne sont larges de 8 bits."}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:" \xb5C Sp\xe9cifications "}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"32 KB Flash (d\xe9termine la taille maximale du programme)"}),"\n",(0,i.jsx)(n.li,{children:"1 KB EEPROM"}),"\n",(0,i.jsx)(n.li,{children:"2 Ko de RAM"}),"\n",(0,i.jsx)(n.li,{children:"Fr\xe9quence d'horloge maximale de 20 MHz"}),"\n",(0,i.jsx)(n.li,{children:"Tension d'alimentation entre 2,7V et 5,5V"}),"\n",(0,i.jsx)(n.li,{children:"6 canaux PWM"}),"\n",(0,i.jsx)(n.li,{children:"8 canaux ADC avec une r\xe9solution de 10 bits"}),"\n",(0,i.jsx)(n.li,{children:"4 ports d'E/S num\xe9riques, chacun avec 8 broches, totalisant 32 broches d'E/S"}),"\n",(0,i.jsx)(n.li,{children:"3 minuteurs (deux 8 bits et un 16 bits)"}),"\n",(0,i.jsx)(n.li,{children:"Interfaces de communication s\xe9rie: USART, SPI, TWI"}),"\n",(0,i.jsx)(n.li,{children:"Interface de programmation ISP et interface de d\xe9bogage JTAG"}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"Nous allons apprendre \xe0 configurer ses broches et \xe0 interagir avec l'environnement externe par le biais du code. Ce microcontr\xf4leur a 40 broches (voir ci-dessous), dont 5 pour les fonctions d'alimentation ou auxiliaires, tandis que 32 sont pour les E/S. Il a quatre ports: A, B, C et D."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Configuration des broches ATmega324P",src:r(6758).A+"",width:"842",height:"726"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Pour plus de d\xe9tails, vous pouvez toujours consulter la ",(0,i.jsx)(n.a,{href:"https://www.microchip.com/downloads/fr/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf",children:"fiche de donn\xe9es"})," (la documentation technique r\xe9sum\xe9e) du microcontr\xf4leur. :)"]})}),"\n",(0,i.jsx)(n.h3,{id:"22-la-carte-de-development-du-laboratoire",children:"2.2. La Carte de development du laboratoire"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/dantudose/PM-Board",children:"La carte du labo"})," est bas\xe9 sur le ",(0,i.jsx)(n.a,{href:"https://www1.microchip.com/downloads/aemDocuments/documents/OTH/ProductDocuments/DataSheets/ATmega164P-324P-644P-Data-Sheet-40002071A.pdf",children:"contr\xf4leur ATmega324P"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"LSM9DS0 - Capteur inertiel \xe0 9 axes (acc\xe9l\xe9rom\xe8tre, gyroscope et magn\xe9tom\xe8tre)"}),"\n",(0,i.jsx)(n.li,{children:"MPL3115 - Capteur altim\xe8tre barom\xe9trique"}),"\n",(0,i.jsx)(n.li,{children:"Capteurs de temp\xe9rature et de lumi\xe8re ambiante"}),"\n",(0,i.jsx)(n.li,{children:"128x160 ST7735 \xe9cran LCD couleur avec lecteur de carte SD"}),"\n",(0,i.jsx)(n.li,{children:"LED RVB"}),"\n",(0,i.jsx)(n.li,{children:"\xe9cran LCD 16x2 caract\xe8res"}),"\n",(0,i.jsx)(n.li,{children:"GPIO LED et boutons"}),"\n",(0,i.jsx)(n.li,{children:"Connecteurs JTAG et FAI"}),"\n",(0,i.jsx)(n.li,{children:"Interface USB programmable et interface de donn\xe9es"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Carte labo",src:r(7132).A+"",width:"451",height:"295"})}),"\n",(0,i.jsx)(n.p,{children:"La carte de laboratoire est un circuit qui donne facilement acc\xe8s aux broches du \xb5C et contient des circuits d'alimentation, de protection et \xe9ventuellement le programmateur \xb5C."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Le programmeur est une puce sp\xe9ciale, parfois m\xeame un autre microcontr\xf4leur, responsable du chargement du code dans la m\xe9moire du \xb5C. Nous ne pouvons pas connecter directement le \xb5C aux lignes USB d'un PC; nous avons besoin d'un interm\xe9diaire pour \"traduire\" cette information."})}),"\n",(0,i.jsx)(n.h3,{id:"23-pinout-de-la-carte",children:"2.3. Pinout de la carte"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"LCD Displays"})}),"\n",(0,i.jsx)(l.A,{left:"    \n  |  Character LCD  |  GPIO Pin  |\n  |  --- | --- |\n  | RS               |  PC0         |\n  | RW               |  PC1         |\n  | EN               |  PC2         |\n  | D4               |  PC3         |\n  | D5               |  PC4         |\n  | D6               |  PC5         |\n  | D7               |  PC6         |\n  | Backlight        |  PC7         |\n  ",right:"\n|  Graphical LCD  |  GPIO Pin  |\n|  --- | --- |\n| CS               |  PB0        |\n| RST              |  PB1        |\n| A0               |  PB4        |\n| SDA              |  PB5        |\n| SCK              |  PB7        |\n| Backlight        |  PA7        |\n"}),"\n",(0,i.jsx)(l.A,{left:"\n  **I2C Sensors & Bus Addresses**\n\n|  I2C          |  GPIO Pin       | Chip     |  Address |\n|  --- | --- | --- | --- |\n| I2C Enable   | PA6          |  LSM9DS0   |  0x1D (XM) 0x6B (G) |\n| SCL          | PC0          | MPL3115A2  |  0x60                |\n| SDA          | PC1          |            |                      |\n",right:"\n**SD Card**\n\n|     \t |  GPIO Pin\t |\n|  --- | --- |\n|  CS\t |  PA2\t |\n|  MOSI  |  PB5 \t |\n|  MISO  |  PB6 \t |\n|  SCK \t |  PB7 \t |\n"}),"\n",(0,i.jsx)(l.A,{left:"\n\n  **RGB LED**\n\n  ||  GPIO Pin\t|\n  |  --- | --- |\n  |  Red\t  |  PD5  |\n  |  Green  |  PD7  |\n  |  Blue\t  |  PB3  |\n",right:"\n\n  **Miscellaneous**\n\n|     \t |  GPIO Pin\t|\n|  --- | --- |\n| Temperature Sensor  |  PA0  |\n| Ambient Light Sensor |  PA1  |\n| Buttons (BTN1 - 6)\t|  PA5  |\n| BTN 1\t                |  PB2  |\n| BTN 2\t                |  PD6  |\n| Speaker\t            |  PD4  |\n"}),"\n",(0,i.jsx)(n.h2,{id:"3-mettons-nous-au-travail",children:"3. Mettons-nous au travail"}),"\n",(0,i.jsx)(n.h3,{id:"31-actionneurs-et-transducteurs-capteurs",children:"3.1. Actionneurs et transducteurs (capteurs)"}),"\n",(0,i.jsx)(n.p,{children:"Pour s'interfacer avec l'environnement externe, divers composants \xe9lectroniques sont utilis\xe9s, soit comme actionneurs (qui modifient l'\xe9tat de l'environnement externe) soit comme transducteurs/capteurs (qui sont influenc\xe9s par l'environnement externe et fournissent des informations au microcontr\xf4leur sur diff\xe9rents param\xe8tres)."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Exemples d'actionneurs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ventilateurs"}),"\n",(0,i.jsx)(n.li,{children:"Indicateurs sonores - buzzers"}),"\n",(0,i.jsx)(n.li,{children:"Indicateurs lumineux"}),"\n",(0,i.jsx)(n.li,{children:"R\xe9sistances chauffantes"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsx)(n.p,{children:"Parfois, un \xe9l\xe9ment d'activation est n\xe9cessaire pour alimenter un actionneur. Par exemple, si nous voulons d\xe9marrer un moteur, le C n'envoie qu'une commande de d\xe9marrage logique \xe0 un transistor, qui s'ouvre ensuite et permet \xe0 un courant plus important de passer (ici, \"grand courant\" est relatif par rapport aux quelques milliamp\xe8res qu'un C peut produire)."})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Capteurs d'exemple"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Boutons"}),"\n",(0,i.jsx)(n.li,{children:"Photor\xe9sistances - leur r\xe9sistance \xe9lectrique est influenc\xe9e par la quantit\xe9 de lumi\xe8re"}),"\n",(0,i.jsx)(n.li,{children:"Thermistances - leur r\xe9sistance \xe9lectrique est influenc\xe9e par la temp\xe9rature"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsx)(n.p,{children:"Selon le type de transducteur, le signal peut n\xe9cessiter un traitement avant d'\xeatre lu par le  \xb5C (conditionnement du signal). Par exemple, une photor\xe9sistance doit \xeatre utilis\xe9e dans un diviseur de tension ou un circuit de source de courant, tandis qu'un bouton peut \xeatre connect\xe9 directement au microcontr\xf4leur."})}),"\n",(0,i.jsx)(n.h4,{id:"311-led",children:"3.1.1 LED"}),"\n",(0,i.jsx)(n.p,{children:"Les LED - diodes \xe9lectroluminescentes - \xe9mettent de la lumi\xe8re lorsqu'elles sont polaris\xe9es vers l'avant. Ne les confondez pas avec les ampoules traditionnelles, car elles fonctionnent de mani\xe8re fondamentalement diff\xe9rente."}),"\n",(0,i.jsx)(n.p,{children:"Selon les semi-conducteurs utilis\xe9s dans leur construction et la lentille en plastique qui agit comme une lentille de dispersion et un filtre optique, les LED peuvent \xe9mettre de la lumi\xe8re dans diff\xe9rentes couleurs. Ne confondez pas les LED avec les ampoules! Alors que les ampoules \xe9mettent de la lumi\xe8re en chauffant un filament de tungst\xe8ne \xe0 des temp\xe9ratures \xe9lev\xe9es, les LED \xe9mettent de la lumi\xe8re en passant du courant \xe0 travers un mat\xe9riau semi-conducteur (jonction p-n)."}),"\n",(0,i.jsx)(n.p,{children:"Les LED peuvent \xeatre utilis\xe9es comme indicateurs d'\xe9tat (souvent utilis\xe9s dans divers appareils pour signaler qu'un appareil est allum\xe9 et ex\xe9cute une fonction) ou pour l'\xe9clairage, o\xf9 des LED de haute puissance sont utilis\xe9es. En laboratoire, les LED sont utilis\xe9es pour indiquer l'\xe9tat d'une broche."}),"\n",(0,i.jsx)(n.p,{children:"Calcul de la r\xe9sistance limite de courant"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Les LED sont des diodes, de sorte que le courant qui les traverse augmente de mani\xe8re exponentielle avec la tension appliqu\xe9e."})}),"\n",(0,i.jsx)(n.p,{children:"Pour utiliser une LED comme indicateur d'\xe9tat pour une broche (plus pr\xe9cis\xe9ment, pour indiquer la pr\xe9sence de tension), le courant \xe0 travers la LED doit \xeatre limit\xe9. La fa\xe7on la plus simple de le faire est de placer une r\xe9sistance en s\xe9rie avec la LED."}),"\n",(0,i.jsx)(n.p,{children:"Une LED est con\xe7ue pour fonctionner \xe0 un courant nominal (par exemple, 10mA). La chute de tension \xe0 ce courant pour les LED indicatrices de faible puissance est d\xe9termin\xe9e par la chimie de la LED (qui d\xe9termine \xe9galement sa couleur). En laboratoire, parce que nous utilisons des LED avec des exigences de courant si faibles, nous pouvons les alimenter directement \xe0 partir des broches logiques du C."}),"\n",(0,i.jsx)(n.p,{children:"Le circuit utilis\xe9 est le suivant:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:" Circuit de travail et calcul de r\xe9sistance de limitation de courant",src:r(9786).A+"",width:"995",height:"723"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Si le microcontr\xf4leur fonctionne \xe0 5V et que nous voulons utiliser une LED rouge \xe0 10mA, avec une chute de tension de 1,7V comme sp\xe9cifi\xe9 par le fabricant, nous devons utiliser une r\xe9sistance de 330 ohms."]}),"\n",(0,i.jsx)(n.h4,{id:"312-boutons",children:"3.1.2 Boutons"}),"\n",(0,i.jsx)(n.p,{children:"La fa\xe7on la plus simple pour un utilisateur d'interagir avec un microcontr\xf4leur est d'utiliser des boutons. La fa\xe7on correcte de connecter un bouton-poussoir dans ce laboratoire est montr\xe9e dans le diagramme ci-dessous:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:" Connexion d&#39;un bouton-poussoir: a) incorrect, avec entr\xe9e flottante, b) correct, avec r\xe9sistance de traction",src:r(6573).A+"",width:"1920",height:"1080"})}),"\n",(0,i.jsx)(n.p,{children:"Raccordement d'un bouton-poussoir: a) incorrect, avec entr\xe9e flottante, b) correct, avec r\xe9sistance de traction"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"a)"})," Affiche un bouton connect\xe9 \xe0 la broche PD0 du C. Lorsque le bouton est press\xe9, l'entr\xe9e PD0 sera connect\xe9e \xe0 GND, ce qui signifie qu'elle sera dans l'\xe9tat logique \"0\". Cette m\xe9thode de connexion est incorrecte car lorsque le bouton n'est pas press\xe9, l'entr\xe9e est dans un \xe9tat ",(0,i.jsx)(n.strong,{children:"non d\xe9fini"})," (comme si on la laissait flottante), elle ne serait pas connect\xe9e \xe0 GND ou Vcc!"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"b)"})," Affiche la bonne fa\xe7on de connecter le bouton, en utilisant une ",(0,i.jsx)(n.strong,{children:"r\xe9sistance d'extraction"})," entre la broche d'entr\xe9e et Vcc. Cette r\xe9sistance garantit que l'entr\xe9e reste dans l'\xe9tat logique \"1\" lorsque le bouton n'est pas press\xe9 en \"tirant\" le potentiel de la ligne \xe0 Vcc. Alternativement, une ",(0,i.jsx)(n.strong,{children:"r\xe9sistance d'extraction"})," (connect\xe9e \xe0 GND) peut \xeatre utilis\xe9e, auquel cas l'entr\xe9e est conserv\xe9e dans l'\xe9tat logique \"0\"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"En laboratoire"}),": Pour \xe9conomiser de l'espace externe, dans l'ATmega328P C, ces r\xe9sistances sont int\xe9gr\xe9es dans le circuit int\xe9gr\xe9. Initialement, elles sont d\xe9sactiv\xe9es et peuvent \xeatre activ\xe9es via un logiciel."]}),"\n",(0,i.jsx)(n.p,{children:"3.2. Utilisation des registres"}),"\n",(0,i.jsx)(n.p,{children:"Cela peut \xeatre consid\xe9r\xe9 comme l'\xe9tape la plus importante lors de l'utilisation d'un  \xb5C. Nous devons apprendre \xe0 configurer le  \xb5C en interne afin qu'il remplisse les fonctions que nous d\xe9sirons. Dans ce laboratoire, nous allons configurer les broches pour fonctionner comme E / S: certaines broches liront s'il y a une tension (entr\xe9e), tandis que d'autres produiront 0 volts ou 5 volts en fonction de nos commandes logicielles."}),"\n",(0,i.jsxs)(n.p,{children:["Pour clarifier la terminologie : quand nous disons ",(0,i.jsx)(n.strong,{children:"nous fixons un registre"})," ou \xe9crivons dans un registre, nous ne faisons pas r\xe9f\xe9rence aux registres \xe0 usage g\xe9n\xe9ral dans le processeur avec lequel vous avez peut-\xeatre travaill\xe9 dans IOCLA. ",(0,i.jsx)(n.strong,{children:"Nous faisons r\xe9f\xe9rence aux adresses m\xe9moire"}),' r\xe9serv\xe9es dans le  \xb5C. R\xe9p\xe9tons ensemble: "Par registre, nous entendons une adresse m\xe9moire."']}),"\n",(0,i.jsxs)(n.p,{children:["Chaque fois que vous avez besoin de configurer un p\xe9riph\xe9rique, la meilleure source pour trouver les param\xe8tres exacts et leurs fonctions est toujours la ",(0,i.jsx)(n.a,{href:"http://www.microchip.com/downloads/fr/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf",children:"fiche d'information"})," de la  \xb5C. Comme il n'est pas pratique d'\xe9crire dans le code des adresses comme *(0x04)"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Pour \xe9crire une valeur dans un registre, vous pouvez attribuer une valeur directement. Cependant, cette m\xe9thode ne rend pas le code tr\xe8s facile \xe0 comprendre. ",(0,i.jsx)(n.em,{children:"Notre recommandation"})," est d'utiliser des masques de bits ((1  x)) ou la macro _BV(x). Nous recommandons \xe9galement d'utiliser le nom de broche au lieu de son index, car les noms sont indicatifs de leur fonction (par exemple, dans le registre ADCSRA du convertisseur bit analogique-num\xe9rique)."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Operation"}),(0,i.jsx)(n.th,{children:"Syntax"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Set bit to 1"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(o.A,{code:a,inline:!0})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Set bit to 0"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(o.A,{code:c,inline:!0})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Toggle bit"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(o.A,{code:d,inline:!0})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Read bit"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(o.A,{code:u,inline:!0})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Exemple : Utilisation des registres"}),"\n",(0,i.jsx)(o.A,{code:h,language:"c"}),"\n",(0,i.jsx)(o.A,{code:m,language:"c"}),"\n",(0,i.jsxs)(n.p,{children:["Pour plus de d\xe9tails sur le travail avec les bits dans les registres, reportez-vous \xe0 la section tutoriel sur le ",(0,i.jsx)(n.a,{href:"https://ocw.cs.pub.ro/courses/pm/tutorial/biti",children:"wiki"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Ne vous inqui\xe9tez pas, nous aurons de nombreuses sessions de laboratoire pour vous habituer \xe0 travailler avec des registres et \xe0 configurer le C. Nous vous encourageons \xe0 faire des efforts d\xe8s maintenant au d\xe9but pour un voyage plus facile tout au long du semestre."}),"\n",(0,i.jsx)(n.h3,{id:"33-registres-des-es",children:"3.3. Registres des E/S"}),"\n",(0,i.jsx)(n.p,{children:"Pour ce laboratoire, nous vous avons \xe9pargn\xe9 la recherche dans la fiche technique, qui peut sembler compliqu\xe9e au premier abord, et avons r\xe9sum\xe9 les adresses m\xe9moire (registres) que vous devez modifier pour compl\xe9ter ce laboratoire."}),"\n",(0,i.jsxs)(n.p,{children:["Le microcontr\xf4leur ATmega324 offre 4 ports d'E/S, chacun avec 8 broches. En interne, chaque port dispose de trois registres 8 bits qui permettent \xe0 l'utilisateur de contr\xf4ler ",(0,i.jsx)(n.em,{children:"le flux de donn\xe9es au niveau de la broche"}),": vous pouvez \xe9crire/lire des donn\xe9es depuis/vers le port respectif. Ces trois registres sont:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"DDRn"})})," - ",(0,i.jsx)(n.em,{children:"Registre des directions de donn\xe9es"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"D\xe9finit la direction des broches de port"}),"\n",(0,i.jsxs)(n.li,{children:["Si le bit ",(0,i.jsx)(n.em,{children:"x"})," vaut ",(0,i.jsx)(n.strong,{children:"0"}),", la broche ",(0,i.jsx)(n.em,{children:"x"})," vaut ",(0,i.jsx)(n.strong,{children:"entr\xe9e"})]}),"\n",(0,i.jsxs)(n.li,{children:["Si le bit ",(0,i.jsx)(n.em,{children:"x"})," vaut ",(0,i.jsx)(n.strong,{children:"1"}),", la broche ",(0,i.jsx)(n.em,{children:"x"})," vaut ",(0,i.jsx)(n.strong,{children:"sortie"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PORTn"})})," - ",(0,i.jsx)(n.em,{children:"Registre des donn\xe9es"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"D\xe9finit les valeurs de sortie des broches ou active/d\xe9sactive les r\xe9sistances de traction"}),"\n",(0,i.jsxs)(n.li,{children:["Si le bit ",(0,i.jsx)(n.em,{children:"x"})," vaut ",(0,i.jsx)(n.strong,{children:"0"})," :"]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"output"}),", ce sera ",(0,i.jsx)(n.strong,{children:"LOW"})]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"entr\xe9e"}),", la r\xe9sistance de traction sera ",(0,i.jsx)(n.strong,{children:"d\xe9sactiv\xe9e"})]}),"\n",(0,i.jsxs)(n.li,{children:["Si le bit ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"1"})," :"]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"output"}),", ce sera ",(0,i.jsx)(n.strong,{children:"HIGH"})]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"entr\xe9e"}),", la r\xe9sistance de traction sera ",(0,i.jsx)(n.strong,{children:"activ\xe9e"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PINn"})})," - ",(0,i.jsx)(n.em,{children:"Epingles d'entr\xe9e Adresse"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si la broche est ",(0,i.jsx)(n.strong,{children:"entr\xe9e"}),", nous pouvons lire les donn\xe9es du port respectif"]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"LOW"}),", alors le bit ",(0,i.jsx)(n.em,{children:"x"})," sera ",(0,i.jsx)(n.strong,{children:"0"})]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche ",(0,i.jsx)(n.em,{children:"x"})," est ",(0,i.jsx)(n.strong,{children:"HIGH"}),", alors le bit ",(0,i.jsx)(n.em,{children:"x"})," sera ",(0,i.jsx)(n.strong,{children:"1"})]}),"\n",(0,i.jsxs)(n.li,{children:["Si la broche est ",(0,i.jsx)(n.strong,{children:"output"}),", nous pouvons la basculer automatiquement"]}),"\n",(0,i.jsxs)(n.li,{children:["Si nous \xe9crivons ",(0,i.jsx)(n.strong,{children:"1"})," au bit ",(0,i.jsx)(n.em,{children:"x"}),", le bit correspondant dans ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PORTn"})})," sera automatiquement invers\xe9 (fonction ",(0,i.jsx)(n.strong,{children:"toggle"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"n"})," peut \xeatre A, B, C ou D, selon le port s\xe9lectionn\xe9. ",(0,i.jsx)(n.em,{children:"x"})," peut \xeatre compris entre 0 et 7."]}),"\n",(0,i.jsxs)(n.p,{children:["Une description d\xe9taill\xe9e des ports et de leurs registres correspondants peut \xeatre trouv\xe9e dans la fiche technique ATmega324, dans le chapitre ",(0,i.jsx)(n.em,{children:"Ports d'E/S"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"331-exemple-de-traitement-des-sorties",children:"3.3.1 Exemple de traitement des sorties"}),"\n",(0,i.jsxs)(n.p,{children:["Supposons que nous ayons une LED connect\xe9e \xe0 la broche 1 du port B (appel\xe9e ",(0,i.jsx)(n.code,{children:"PORTB1"})," ou ",(0,i.jsx)(n.code,{children:"PB1"}),"). Pour allumer ou \xe9teindre la LED, proc\xe9dez comme suit:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Configurer la broche ",(0,i.jsx)(n.code,{children:"PB1"})," comme sortie :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Le bit 1 (",(0,i.jsx)(n.code,{children:"PB1"}),") dans le registre ",(0,i.jsx)(n.code,{children:"DDRB"})," doit \xeatre mis \xe0 1"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"DDRB |= (1 << PB1);"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Pour allumer la LED, r\xe9glez la broche ",(0,i.jsx)(n.code,{children:"PB1"})," \xe0 ",(0,i.jsx)(n.strong,{children:"HIGH"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Le bit 1 (PB1) dans le registre ",(0,i.jsx)(n.code,{children:"PORTB"})," doit \xeatre r\xe9gl\xe9 sur 1"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PORTB |= (1 << PB1);"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Pour d\xe9sactiver la LED, r\xe9glez la broche ",(0,i.jsx)(n.code,{children:"PB1"})," sur ",(0,i.jsx)(n.strong,{children:"LOW"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Le bit 1 (",(0,i.jsx)(n.code,{children:"PB1"}),") dans le registre ",(0,i.jsx)(n.code,{children:"PORTB"})," doit \xeatre mis \xe0 0"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PORTB &= ~(1 << PB1);"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"332-exemple-de-traitement-des-entr\xe9es",children:"3.3.2. Exemple de traitement des entr\xe9es"}),"\n",(0,i.jsxs)(n.p,{children:["Supposons que nous ayons un bouton connect\xe9 \xe0 la broche 4 du port D (appel\xe9 ",(0,i.jsx)(n.code,{children:"PORTD4"})," ou ",(0,i.jsx)(n.code,{children:"PD4"}),"), en utilisant la connexion correcte du cas ",(0,i.jsx)(n.strong,{children:"b)"})," montr\xe9 pr\xe9c\xe9demment. Pour d\xe9terminer l'\xe9tat du bouton (appuy\xe9 ou lib\xe9r\xe9), proc\xe9dez comme suit:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Configurer la broche ",(0,i.jsx)(n.code,{children:"PD4"})," comme entr\xe9e :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Le bit 4 (",(0,i.jsx)(n.code,{children:"PD4"}),") dans le registre DDRD doit \xeatre mis \xe0 0"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"DDRD &= ~(1 << PD4);"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Pour d\xe9terminer si le bouton est press\xe9, lisez la valeur de la broche \xe0 laquelle il est attach\xe9. Il sera 1 lorsque le bouton est rel\xe2ch\xe9 et 0 lorsque le bouton est press\xe9:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Lire le bit 4 (",(0,i.jsx)(n.code,{children:"PD4"}),") dans le registre ",(0,i.jsx)(n.code,{children:"PIND"}),":"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"char val = PIND & (1 << PD4);"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"4-d\xe9velopper-des-programmes-pour-avr",children:"4. D\xe9velopper des programmes pour AVR"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"D\xe9veloppement et compilation sans PlatformIO "}),(0,i.jsx)(n.h3,{id:"41-d\xe9veloppement-et-compilation",children:"4.1. D\xe9veloppement et compilation"}),(0,i.jsx)(n.p,{children:"Pour le d\xe9veloppement de programmes, nous pouvons utiliser n'importe quel \xe9diteur de texte."}),(0,i.jsxs)(n.p,{children:["Dans les laboratoires, nous \xe9crirons le code C, pas l'assemblage (AVRASM), en utilisant le compilateur ",(0,i.jsx)(n.a,{href:"https://gcc.gnu.org/wiki/avr-gcc",children:"avr-gcc"}),". WinAVR inclut la biblioth\xe8que C, avr-libc, qui doit \xeatre install\xe9e sur les syst\xe8mes Linux et Windows (",(0,i.jsx)(n.a,{href:"http://winavr.sourceforge.net/",children:"WinAVR"}),"."]}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Compilation Process with AVR-GCC",src:r(2205).A+"",width:"834",height:"303"})}),(0,i.jsx)(n.p,{children:"Bien que notre microcontr\xf4leur soit 8 bits, en code C, nous pouvons utiliser des variables enti\xe8res de 16/32/64 bits et m\xeame des nombres \xe0 virgule flottante. Le compilateur g\xe8re la traduction des instructions en code d'assemblage qui fonctionne sur une architecture 8 bits."}),(0,i.jsx)(n.p,{children:"Comme pour les syst\xe8mes Linux, pour programmer AVR, nous avons besoin de quelques utilitaires : le compilateur avr-gcc, avr-libc et AVRDUDE. Pour installer ces utilitaires, Homebrew est recommand\xe9. Utilisez les commandes suivantes :"}),(0,i.jsx)(o.A,{code:p,language:"bash"}),(0,i.jsxs)(n.p,{children:["Pour fonctionner sur les processeurs M1/M2/M3, vous devez installer au moins la version 11 d'avr-gcc.\nPlus d'exemples peuvent \xeatre trouv\xe9s ",(0,i.jsx)(n.a,{href:"https://wellys.com/posts/avr_c_macos/",children:"ici"}),"."]}),(0,i.jsx)(n.h3,{id:"42-programmation-du-microcontr\xf4leur",children:"4.2. Programmation du microcontr\xf4leur"}),(0,i.jsx)(n.p,{children:"Un microcontr\xf4leur peut \xeatre programm\xe9 en utilisant diverses m\xe9thodes, telles que la programmation d'interface s\xe9rie, un programmeur ISP (In-System Programming) en utilisant l'interface SPI, ou un bootloader."}),(0,i.jsxs)(n.p,{children:["Dans ce laboratoire, nous utiliserons la derni\xe8re m\xe9thode car elle \xe9limine le besoin de composants externes suppl\xe9mentaires pour t\xe9l\xe9charger le fichier hexad\xe9cimal. Un ",(0,i.jsx)(n.strong,{children:"bootloader"})," est un programme pr\xe9charg\xe9 (utilisant, par exemple, un programmeur FAI) \xe0 la fin de la m\xe9moire du programme du microcontr\xf4leur. L'ex\xe9cution du code t\xe9l\xe9charg\xe9 commencera \xe0 partir de la section de d\xe9marrage. L'inconv\xe9nient de cette m\xe9thode est l'espace m\xe9moire occup\xe9 par le bootloader."]}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Ex\xe9cution de programmes \xe0 l&#39;aide d&#39;un bootloader",src:r(9036).A+"",width:"392",height:"338"})}),(0,i.jsx)(n.p,{children:"L'utilisation d'un bootloader n\xe9cessite de remplir une condition au d\xe9marrage du microcontr\xf4leur. Sur les cartes de laboratoire, il s'ex\xe9cute sur chaque RESET, mais nous pouvons d\xe9finir n'importe quelle condition d\xe9tectable par le processeur (par exemple, si un bouton est press\xe9 ou non). Certains microcontr\xf4leurs ont une ROM d\xe9di\xe9e pour le bootloader, install\xe9e en usine (par exemple, STM32)."}),(0,i.jsxs)(n.p,{children:["Pour t\xe9l\xe9charger le programme sur le microcontr\xf4leur, nous devons utiliser un utilitaire sur l'ordinateur. Ci-dessous un exemple d'utilisation de l'utilitaire ",(0,i.jsx)(n.strong,{children:"vrdude"})," sur Linux et Windows:"]}),(0,i.jsx)(o.A,{code:x,language:"bash"})]}),"\n",(0,i.jsx)(n.h3,{id:"43-platformio",children:"4.3. PlatformIO"}),"\n",(0,i.jsxs)(n.p,{children:["Pour une solution ",(0,i.jsx)(n.strong,{children:"toolchain et IDE"})," tout-en-un, installez ",(0,i.jsx)(n.a,{href:"https://platformio.org/",children:"PlatformIO"}),". Apr\xe8s avoir install\xe9 l'extension PlatformIO dans VSCode, cr\xe9ez un nouveau projet ciblant ATmega324P en tant que plate-forme/microcontr\xf4leur et ajoutez la ligne suivante \xe0 ",(0,i.jsx)(n.strong,{children:"platformio.ini"})," :"]}),"\n",(0,i.jsx)(o.A,{code:j,language:"bash"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Alternative \xe0 PlatformIO "}),(0,i.jsx)(n.p,{children:"4.3.1 Alternative \xe0 PlatformIO : Installation s\xe9par\xe9e de la cha\xeene d'outils avr-gcc"}),(0,i.jsxs)(n.p,{children:["D'accord, vous \xeates un d\xe9veloppeur de logiciels hardcore et vous voulez installer la cha\xeene d'outils directement \xe0 l'aide de votre IDE pr\xe9f\xe9r\xe9 (qui est-ce que je plaisante, vous travaillez directement dans Vim). Vous avez cette option aussi, mais il vient avec quelques maux de t\xeate. Si vous voulez installer juste la cha\xeene d'outils, sans un IDE, vous aurez besoin ",(0,i.jsx)(n.strong,{children:"avr-gcc"}),", ",(0,i.jsx)(n.strong,{children:"make"})," et ",(0,i.jsx)(n.strong,{children:"avrdude"})," pour compiler et programmer les guides de d\xe9veloppement."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://baremetalmicro.com/tutorial_avr_toolchain/03-Install-on-Ubuntu-Linux.html",children:"Linux"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://tinusaur.com/guides/avr-gcc-toolchain/",children:"Windows"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://wellys.com/posts/avr_c_macos/",children:"Mac"})}),"\n"]}),(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Il est possible que l'installation par d\xe9faut d'avrdude ne prenne pas en charge le bootloader ",(0,i.jsx)(n.strong,{children:"urclock"})," sur la carte, et que vous receviez un message d'erreur lors de l'ex\xe9cution de ",(0,i.jsx)(n.strong,{children:"make upload"}),". Pour r\xe9soudre ce probl\xe8me, vous devez installer avrdude 7.2-arduino.1 (ou installer PlatformIO directement, qui est livr\xe9 avec la version correcte d'avrdude)."]})}),(0,i.jsxs)(n.p,{children:["Nous vous recommandons \xe9galement d'utiliser un IDE pour le d\xe9veloppement de code. Si vous pr\xe9f\xe9rez VSCode (sans l'extension PlatformIO), consultez ce ",(0,i.jsx)(n.a,{href:"https://www.youtube.com/watch?vLE7-uzhlGVM&ab_channelWhiteHeart",children:"tutorial"}),"."]}),(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Avertissement"}),": Support du programmeur urclock (\xe9galement connu sous le nom de urprotocol), utilis\xe9 par nos cartes, ",(0,i.jsx)(n.a,{href:"https://github.com/avrdudes/avrdude/Windows/main/NEWS",children:"a \xe9t\xe9 seulement ajout\xe9"})," dans avrdudeSystem > 7.1. Assurez-vous de ne pas installer une version r\xe9cente (par exemple, ",(0,i.jsx)(n.strong,{children:"7.3"}),")."]})})]}),"\n",(0,i.jsx)(n.h3,{id:"44-bonjour-tout-le-monde-hello-world",children:"4.4. Bonjour tout le monde (Hello World)"}),"\n",(0,i.jsxs)(n.p,{children:["Nous \xe9crirons un programme qui active et d\xe9sactive une LED \xe0 des intervalles de 500 ms. La LED cibl\xe9e est la LED verte sur la carte du laboratoire. Ceci se fait en modifiant la tension d'une des broches du microcontr\xf4leur, dans notre cas, la broche 7 du port D (",(0,i.jsx)(n.code,{children:"PD7"}),")."]}),"\n",(0,i.jsx)(o.A,{code:g,language:"c"}),"\n",(0,i.jsxs)(n.p,{children:["Pour compiler avec PlatformIO, appuyez sur ",(0,i.jsx)(n.strong,{children:"Ctrl+Alt+B"}),", puis ",(0,i.jsx)(n.strong,{children:"Ctrl+Alt+U"})," pour t\xe9l\xe9charger."]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:" Utilisation d'un Makefile personnalis\xe9 pour la compilation "}),(0,i.jsx)(n.p,{children:"Si vous avez install\xe9 la cha\xeene d'outils s\xe9par\xe9ment, vous devez utiliser le Makefile suivant :"}),(0,i.jsx)(o.A,{code:v,language:"Makefile"}),(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["Le compilateur utilis\xe9 est ",(0,i.jsx)(n.strong,{children:"avr-gcc"}),". Les drapeaux ont les significations suivantes :"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["-",(0,i.jsx)(n.code,{children:"mmcu"})," : Informe le compilateur du type de microcontr\xf4leur pour lequel le code doit \xeatre g\xe9n\xe9r\xe9."]}),"\n",(0,i.jsxs)(n.li,{children:["-",(0,i.jsx)(n.code,{children:"DF_CPU12000000"})," : D\xe9finit la macro F_CPU, qui indique la fr\xe9quence d'horloge du microcontr\xf4leur."]}),"\n",(0,i.jsxs)(n.li,{children:["-",(0,i.jsx)(n.code,{children:"Os"}),": Optimise le programme pour l'utilisation de la m\xe9moire (assez utile compte tenu de la m\xe9moire limit\xe9e sur la puce)."]}),"\n",(0,i.jsxs)(n.li,{children:["-",(0,i.jsx)(n.code,{children:"Wall"})," : active tous les messages d'avertissement."]}),"\n"]}),(0,i.jsxs)(n.p,{children:["Le fichier \xe0 programmer sur la carte doit \xeatre au format ",(0,i.jsx)(n.em,{children:"ihex"}),". Par cons\xe9quent, il est n\xe9cessaire d'extraire les donn\xe9es et les sections de code du fichier ELF compil\xe9 et de les int\xe9grer dans un fichier ",(0,i.jsx)(n.em,{children:"ihex"}),". Cette \xe9tape est effectu\xe9e \xe0 l'aide de l'utilitaire ",(0,i.jsx)(n.strong,{children:"avr-objcopy"}),"."]}),(0,i.jsxs)(n.p,{children:["La commande ",(0,i.jsx)(n.strong,{children:"avr-size"})," indique la quantit\xe9 de m\xe9moire occup\xe9e par les diff\xe9rentes sections du programme. Gardez \xe0 l'esprit que dans la m\xe9moire SRAM pour les donn\xe9es, outre la section .data, la pile sera \xe9galement plac\xe9e. Pour ex\xe9cuter le programme sur le microcontr\xf4leur ATmega324, la section .text doit \xeatre inf\xe9rieure \xe0 32 Ko, et la section .data doit \xeatre inf\xe9rieure \xe0 2 Ko."]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Le r\xe9sultat de la compilation est le fichier ",(0,i.jsx)(n.strong,{children:"main.hex"}),". Ce fichier est ensuite t\xe9l\xe9charg\xe9 sur le microcontr\xf4leur \xe0 l'aide de la r\xe8gle ",(0,i.jsx)(n.strong,{children:"upload"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"5-exercices",children:"5. Exercices"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"T\xe2che 0"})," Commen\xe7ons par v\xe9rifier la configuration."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Installez votre IDE pr\xe9f\xe9r\xe9 / requis et ex\xe9cutez l'exemple Hello World sur la carte de d\xe9veloppement dans le laboratoire."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T\xe2che 1"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Modifiez l'exemple Hello World pour que la LED allum\xe9e soit rouge au lieu de verte. Conseil : Trouvez la broche et le port auxquels cette LED (qui fait partie de la LED RGB) est connect\xe9e dans le ",(0,i.jsx)(n.a,{href:"https://raw.githubusercontent.com/dantudose/PM-Board/main/Hardware/schematic.pdf",children:"sch\xe9ma de la carte"})," / ",(0,i.jsx)(n.a,{href:"https://github.com/dose",children:"documentation du tableau sur GitHub"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remarque"}),": La LED RVB a une anode commune, donc l'\xe9criture d'un 1 logique sur la broche GPIO correspondante \xe9teint la LED."]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T\xe2che 2"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Modifier l'exemple Bonjour le monde de sorte que la LED change de couleur lorsque le bouton 1 (",(0,i.jsx)(n.code,{children:"PB2"}),") est press\xe9."]}),"\n",(0,i.jsx)(n.li,{children:"Gardez la LED verte allum\xe9e par d\xe9faut."}),"\n",(0,i.jsxs)(n.li,{children:["Configurer les registres pour d\xe9finir ",(0,i.jsx)(n.code,{children:"PB2"})," comme entr\xe9e."]}),"\n",(0,i.jsxs)(n.li,{children:["Configurez la LED pour ajouter une autre couleur (rouge/bleu) lorsque vous appuyez sur le bouton. (N'oubliez pas d'activer la r\xe9sistance de traction interne du  \xb5C pour ",(0,i.jsx)(n.code,{children:"PB2"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T\xe2che 3"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\xc0 partir de l'application cr\xe9\xe9e dans la t\xe2che 2, modifiez la fonctionnalit\xe9 du bouton 1 pour parcourir les couleurs LED sur des pressions successives (premi\xe8re pression - rouge, deuxi\xe8me pression - vert, troisi\xe8me pression - bleu, etc.)."}),"\n",(0,i.jsx)(n.li,{children:"Utilisez le bouton 2 pour basculer entre une LED clignotante (clignotement) et un \xe9tat solide (une pression - clignotement, deuxi\xe8me pression - toujours allum\xe9e, pression suivante - clignote \xe0 nouveau, etc.)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"6-liens-utiles",children:"6. Liens utiles"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://www.avrfreaks.net/",children:"AVR Freaks Community"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://www.nongnu.org/avr-libc/user-manual/modules.html",children:"Documentation AVR libc"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://gcc.gnu.org/wiki/avr-gcc",children:"Compilateur AVR GCC"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://hackaday.com/2010/10/23/avr-programming-introduction/",children:"D\xe9tails d'introduction sur la programmation AVR (Blog)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://electronics.howstuffworks.com/led.htm",children:"Comment fonctionnent les LED"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://raw.githubusercontent.com/dantudose/PM-Board/main/Hardware/schematic.pdf",children:"Sch\xe9matique du Conseil de d\xe9veloppement du PM"})}),"\n"]})]})}function C(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(q,{...e})}):q(e)}},9716:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/projects-cadd216f930c366a37303d3a9e0f65b7.png"},9786:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/r_limit-f5e5fd5b3b2a2a99d50edebba2592626.png"},9804:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/atmel-atmega324p-20pu-68e7d21082aaadc88b29af54b5215b74.jpg"}}]);
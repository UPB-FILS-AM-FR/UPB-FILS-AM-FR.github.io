<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper plugin-docs plugin-id-lab docs-version-current docs-doc-page docs-doc-id-lab00/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Laboratoire 0 : ATmega324. GPIO | Microprocessor Architecture</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://upb-fils-am-fr.github.io/fr/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://upb-fils-am-fr.github.io/fr/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://upb-fils-am-fr.github.io/fr/lab/lab00"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" property="og:locale:alternate" content="en_GB"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-lab-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-lab-current"><meta data-rh="true" property="og:title" content="Laboratoire 0 : ATmega324. GPIO | Microprocessor Architecture"><meta data-rh="true" name="description" content="Chapitres utiles de ATmega324P Datasheet"><meta data-rh="true" property="og:description" content="Chapitres utiles de ATmega324P Datasheet"><link data-rh="true" rel="icon" href="/fr/img/sigla_am.ico"><link data-rh="true" rel="canonical" href="https://upb-fils-am-fr.github.io/fr/lab/lab00"><link data-rh="true" rel="alternate" href="https://upb-fils-am-fr.github.io/lab/lab00" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://upb-fils-am-fr.github.io/fr/lab/lab00" hreflang="fr"><link data-rh="true" rel="alternate" href="https://upb-fils-am-fr.github.io/lab/lab00" hreflang="x-default"><link rel="stylesheet" href="/fr/assets/css/styles.f442cfaf.css">
<script src="/fr/assets/js/runtime~main.cefaed66.js" defer="defer"></script>
<script src="/fr/assets/js/main.a182e1fa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/fr/img/sigla_am.svg"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fr/"><div class="navbar__logo"><img src="/fr/img/sigla_am.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/fr/img/sigla_am.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Microprocessor Architecture</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fr/lab">Lab</a><a class="navbar__item navbar__link" href="/fr/project">Project</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Français</a><ul class="dropdown__menu"><li><a href="/lab/lab00" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/fr/lab/lab00" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="fr">Français</a></li></ul></div><a href="https://github.com/UPB-FILS-AM-FR/am-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab">Info General Labo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/fr/lab/lab00">Laboratoire 0 : ATmega324. GPIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab/lab01">Laboratoire 1 : USART. Débogage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab/lab02">Laboratoire 2 : Interruptions, Timers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab/lab03">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab/lab04">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab/lab05">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/lab/lab06">Lab 6</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/fr/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Laboratoire 0 : ATmega324. GPIO</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Laboratoire 0 : ATmega324. GPIO</h1></header>
<p><strong>Chapitres utiles de</strong> <strong><a href="https://ww1.microchip.com/downloads/fr/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf" target="_blank" rel="noopener noreferrer">ATmega324P Datasheet</a></strong></p>
<ul>
<li>
<ol>
<li>Configuration des broches - page 15</li>
</ol>
</li>
<li>
<ol start="13">
<li>E/S-Ports - page 95</li>
</ol>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-introduction">1. Introduction<a href="#1-introduction" class="hash-link" aria-label="Lien direct vers 1. Introduction" title="Lien direct vers 1. Introduction">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-pourquoi-">1.1. Pourquoi ?<a href="#11-pourquoi-" class="hash-link" aria-label="Lien direct vers 1.1. Pourquoi ?" title="Lien direct vers 1.1. Pourquoi ?">​</a></h3>
<p><strong>Q</strong>: Que faisons-nous ici? Où est ce que nous apprenons utilisé? Est-ce vraiment utile?</p>
<p><strong>A</strong>: Pour répondre brièvement: &quot;beaucoup&quot;, &quot;partout&quot; et &quot;oui&quot;; mais commençons par un exemple.</p>
<p>Vous venez de construire un nouveau PC et d&#x27;installer un éclairage RVB sur la RAM, les ventilateurs et la coque. Maintenant vient la question: qui &quot;appuie&quot; sur les boutons pour que les couleurs apparaissent comme définies dans le logiciel? Le CPU devrait-il s&#x27;asseoir et gérer le changement des couleurs? Ce serait un gaspillage de ressources. C&#x27;est là qu&#x27;un microcontrôleur entre en jeu! C&#x27;est un processeur plus petit et plus simple avec une tâche bien définie au sein du système.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-quest-ce-quun-microcontrôleur-µc-">1.2. Qu&#x27;est-ce qu&#x27;un microcontrôleur (µC) ?<a href="#12-quest-ce-quun-microcontrôleur-µc-" class="hash-link" aria-label="Lien direct vers 1.2. Qu&#x27;est-ce qu&#x27;un microcontrôleur (µC) ?" title="Lien direct vers 1.2. Qu&#x27;est-ce qu&#x27;un microcontrôleur (µC) ?">​</a></h3>
<p>TLDR: Un ordinateur dans une puce. Plus précisément, il s&#x27;agit d&#x27;un circuit intégré qui comprend une unité de traitement (CPU), une mémoire (RAM volatile, EEPROM non volatile, Flash, ROM) et divers périphériques qui lui permettent de communiquer avec l&#x27;environnement externe.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-µc-dans-la-nature">1.3. µC dans la nature<a href="#13-µc-dans-la-nature" class="hash-link" aria-label="Lien direct vers 1.3. µC dans la nature" title="Lien direct vers 1.3. µC dans la nature">​</a></h3>
<p>Nous les trouvons dans divers appareils tels que les téléphones, les appareils ménagers, les satellites, les avions, les usines, etc. Il existe une large gamme de microcontrôleurs disponibles, sélectionnés en fonction de l&#x27;application, en tenant compte principalement de l&#x27;optimisation des coûts et de la consommation d&#x27;énergie pour l&#x27;appareil où le C sera utilisé.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Example projects</summary><div><div class="collapsibleContent_i85q"><p><img decoding="async" loading="lazy" alt="projects" src="/fr/assets/images/projects-cadd216f930c366a37303d3a9e0f65b7.png" width="1066" height="395" class="img_ev3q"></p><ul>
<li><a href="https://www.northstarst.com/" target="_blank" rel="noopener noreferrer">[1, 2] - Suivi des oiseaux</a></li>
<li>[[3] - Palm size quad-copter] (<a href="http://www.rcgroups.com/forums/showthread.php?t1335765" target="_blank" rel="noopener noreferrer">http://www.rcgroups.com/forums/showthread.php?t1335765</a>)</li>
<li>[4] - Robot suiveur de ligne (Tare N&#x27; Bar)</li>
<li>[5] - Robot de football (IronFoot)</li>
<li>[6] - Robot sous-marin (R0X1)</li>
<li>[[7] - Skateboard auto-équilibrant] (<a href="http://www.instructables.com/id/Easy-build-self-balancing-skateboardrobotsegway-/" target="_blank" rel="noopener noreferrer">http://www.instructables.com/id/Easy-build-self-balancing-skateboardrobotsegway-/</a>)</li>
</ul><p>Pour plus d&#x27;exemples, vous pouvez commencer à chercher ici : <a href="https://www.hackster.io/projects/tags/microcontroller" target="_blank" rel="noopener noreferrer">https://www.hackster.io/projects/tags/microcontroller</a></p></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-quy-a-t-il-à-lintérieur-dun-µc-">1.4. Qu’y a-t-il à l’intérieur d’un µC ?<a href="#14-quy-a-t-il-à-lintérieur-dun-µc-" class="hash-link" aria-label="Lien direct vers 1.4. Qu’y a-t-il à l’intérieur d’un µC ?" title="Lien direct vers 1.4. Qu’y a-t-il à l’intérieur d’un µC ?">​</a></h3>
<ul>
<li><strong>Central Processing Unit</strong> (P core) avec des architectures de 8, 16, 32 ou 64 bits</li>
<li>Mémoire de données volatiles (<strong>RAM</strong>) et/ou mémoire non volatile (Flash ou EEPROM)</li>
<li>Mémoire de programme non volatile (<strong>Flash</strong> ou <strong>EEPROM</strong>)</li>
<li>Ports d&#x27;entrée-sortie numériques à usage général (<strong>GPIO</strong> - Sortie d&#x27;entrée à usage général)</li>
<li>Interfaces de communication série (<strong>USART</strong>, <strong>SPI</strong>, <strong>I2C</strong>, PCM, <strong>USB</strong>, SDIO, etc.)</li>
<li>Interfaces Ethernet</li>
<li>Interfaces pour affichages graphiques (LVDS, <strong>HDMI</strong>, ou autres protocoles de contrôle LCD dédiés)</li>
<li>Minuteurs (internes ou utilisés pour générer des signaux périodiques - par exemple, PWM - ou comme chien de garde)</li>
<li>Convertisseurs analogique-numérique et numérique-analogique (<strong>ADC</strong>, <strong>DAC</strong>), frontaux analogiques et autres circuits pour signaux analogiques</li>
<li>Source de tension intégrée</li>
<li>Interface de programmation et de débogage</li>
</ul>
<p><strong>Les périphériques</strong> représentent tout périphérique interne ou externe qui se connecte à un système informatique et étend ses fonctionnalités de base. Dans le cas d&#x27;un microcontrôleur, plusieurs de ces périphériques sont intégrés directement dans la puce (exemples ci-dessus). Bien qu&#x27;ils ne ressemblent pas à des périphériques PC (moniteur, carte graphique, clavier, souris, etc.), sans eux, le microcontrôleur ne serait pas en mesure d&#x27;interagir avec le monde extérieur.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-micropuce-atmel-avr">2. Micropuce (Atmel) AVR<a href="#2-micropuce-atmel-avr" class="hash-link" aria-label="Lien direct vers 2. Micropuce (Atmel) AVR" title="Lien direct vers 2. Micropuce (Atmel) AVR">​</a></h2>
<p>Tout au long du semestre, nous travaillerons avec des microcontrôleurs de la famille AVR de Microchip. Ceux-ci ont une architecture Harvard 8 bits et un jeu d&#x27;instructions réduit (RISC).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-atmega324p">2.1. ATmega324P<a href="#21-atmega324p" class="hash-link" aria-label="Lien direct vers 2.1. ATmega324P" title="Lien direct vers 2.1. ATmega324P">​</a></h3>
<p><img decoding="async" loading="lazy" alt="ATmega324P" src="/fr/assets/images/atmel-atmega324p-20pu-68e7d21082aaadc88b29af54b5215b74.jpg" width="640" height="640" class="img_ev3q"></p>
<p>Il s&#x27;agit d&#x27;un microcontrôleur 8 bits de la famille megaAVR, que nous utiliserons tout au long du semestre. Ses registres et son bus de données interne sont larges de 8 bits.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> µC Spécifications </summary><div><div class="collapsibleContent_i85q"><ul>
<li>32 KB Flash (détermine la taille maximale du programme)</li>
<li>1 KB EEPROM</li>
<li>2 Ko de RAM</li>
<li>Fréquence d&#x27;horloge maximale de 20 MHz</li>
<li>Tension d&#x27;alimentation entre 2,7V et 5,5V</li>
<li>6 canaux PWM</li>
<li>8 canaux ADC avec une résolution de 10 bits</li>
<li>4 ports d&#x27;E/S numériques, chacun avec 8 broches, totalisant 32 broches d&#x27;E/S</li>
<li>3 minuteurs (deux 8 bits et un 16 bits)</li>
<li>Interfaces de communication série: USART, SPI, TWI</li>
<li>Interface de programmation ISP et interface de débogage JTAG</li>
</ul></div></div></details>
<p>Nous allons apprendre à configurer ses broches et à interagir avec l&#x27;environnement externe par le biais du code. Ce microcontrôleur a 40 broches (voir ci-dessous), dont 5 pour les fonctions d&#x27;alimentation ou auxiliaires, tandis que 32 sont pour les E/S. Il a quatre ports: A, B, C et D.</p>
<p><img decoding="async" loading="lazy" alt="Configuration des broches ATmega324P" src="/fr/assets/images/atmega324pins-c8dc52d6a8794d0a4ded4788301bfaa6.png" width="842" height="726" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>remarque</div><div class="admonitionContent_BuS1"><p>Pour plus de détails, vous pouvez toujours consulter la <a href="https://www.microchip.com/downloads/fr/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf" target="_blank" rel="noopener noreferrer">fiche de données</a> (la documentation technique résumée) du microcontrôleur. :)</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-la-carte-de-development-du-laboratoire">2.2. La Carte de development du laboratoire<a href="#22-la-carte-de-development-du-laboratoire" class="hash-link" aria-label="Lien direct vers 2.2. La Carte de development du laboratoire" title="Lien direct vers 2.2. La Carte de development du laboratoire">​</a></h3>
<p><a href="https://github.com/dantudose/PM-Board" target="_blank" rel="noopener noreferrer">La carte du labo</a> est basé sur le <a href="https://www1.microchip.com/downloads/aemDocuments/documents/OTH/ProductDocuments/DataSheets/ATmega164P-324P-644P-Data-Sheet-40002071A.pdf" target="_blank" rel="noopener noreferrer">contrôleur ATmega324P</a></p>
<ul>
<li>LSM9DS0 - Capteur inertiel à 9 axes (accéléromètre, gyroscope et magnétomètre)</li>
<li>MPL3115 - Capteur altimètre barométrique</li>
<li>Capteurs de température et de lumière ambiante</li>
<li>128x160 ST7735 écran LCD couleur avec lecteur de carte SD</li>
<li>LED RVB</li>
<li>écran LCD 16x2 caractères</li>
<li>GPIO LED et boutons</li>
<li>Connecteurs JTAG et FAI</li>
<li>Interface USB programmable et interface de données</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Carte labo" src="/fr/assets/images/placuta-53a4f6f26ddb1097302ba7c6fa988f2a.png" width="451" height="295" class="img_ev3q"></p>
<p>La carte de laboratoire est un circuit qui donne facilement accès aux broches du µC et contient des circuits d&#x27;alimentation, de protection et éventuellement le programmateur µC.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Le programmeur est une puce spéciale, parfois même un autre microcontrôleur, responsable du chargement du code dans la mémoire du µC. Nous ne pouvons pas connecter directement le µC aux lignes USB d&#x27;un PC; nous avons besoin d&#x27;un intermédiaire pour &quot;traduire&quot; cette information.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-pinout-de-la-carte">2.3. Pinout de la carte<a href="#23-pinout-de-la-carte" class="hash-link" aria-label="Lien direct vers 2.3. Pinout de la carte" title="Lien direct vers 2.3. Pinout de la carte">​</a></h3>
<p><strong>LCD Displays</strong></p>
<div style="display:flex;gap:20px;align-items:flex-start"><div style="flex:1"><table><thead><tr><th>Character LCD</th><th>GPIO Pin</th></tr></thead><tbody><tr><td>RS</td><td>PC0</td></tr><tr><td>RW</td><td>PC1</td></tr><tr><td>EN</td><td>PC2</td></tr><tr><td>D4</td><td>PC3</td></tr><tr><td>D5</td><td>PC4</td></tr><tr><td>D6</td><td>PC5</td></tr><tr><td>D7</td><td>PC6</td></tr><tr><td>Backlight</td><td>PC7</td></tr></tbody></table> </div><div style="flex:1"><table><thead><tr><th>Graphical LCD</th><th>GPIO Pin</th></tr></thead><tbody><tr><td>CS</td><td>PB0</td></tr><tr><td>RST</td><td>PB1</td></tr><tr><td>A0</td><td>PB4</td></tr><tr><td>SDA</td><td>PB5</td></tr><tr><td>SCK</td><td>PB7</td></tr><tr><td>Backlight</td><td>PA7</td></tr></tbody></table> </div></div>
<div style="display:flex;gap:20px;align-items:flex-start"><div style="flex:1"><p><strong>I2C Sensors &amp; Bus Addresses</strong></p>
<table><thead><tr><th>I2C</th><th>GPIO Pin</th><th>Chip</th><th>Address</th></tr></thead><tbody><tr><td>I2C Enable</td><td>PA6</td><td>LSM9DS0</td><td>0x1D (XM) 0x6B (G)</td></tr><tr><td>SCL</td><td>PC0</td><td>MPL3115A2</td><td>0x60</td></tr><tr><td>SDA</td><td>PC1</td><td></td><td></td></tr></tbody></table> </div><div style="flex:1"><p><strong>SD Card</strong></p>
<table><thead><tr><th></th><th>GPIO Pin</th></tr></thead><tbody><tr><td>CS</td><td>PA2</td></tr><tr><td>MOSI</td><td>PB5</td></tr><tr><td>MISO</td><td>PB6</td></tr><tr><td>SCK</td><td>PB7</td></tr></tbody></table> </div></div>
<div style="display:flex;gap:20px;align-items:flex-start"><div style="flex:1"><p><strong>RGB LED</strong></p>
<table><thead><tr><th></th><th>GPIO Pin</th></tr></thead><tbody><tr><td>Red</td><td>PD5</td></tr><tr><td>Green</td><td>PD7</td></tr><tr><td>Blue</td><td>PB3</td></tr></tbody></table> </div><div style="flex:1"><p><strong>Miscellaneous</strong></p>
<table><thead><tr><th></th><th>GPIO Pin</th></tr></thead><tbody><tr><td>Temperature Sensor</td><td>PA0</td></tr><tr><td>Ambient Light Sensor</td><td>PA1</td></tr><tr><td>Buttons (BTN1 - 6)</td><td>PA5</td></tr><tr><td>BTN 1</td><td>PB2</td></tr><tr><td>BTN 2</td><td>PD6</td></tr><tr><td>Speaker</td><td>PD4</td></tr></tbody></table> </div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-mettons-nous-au-travail">3. Mettons-nous au travail<a href="#3-mettons-nous-au-travail" class="hash-link" aria-label="Lien direct vers 3. Mettons-nous au travail" title="Lien direct vers 3. Mettons-nous au travail">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-actionneurs-et-transducteurs-capteurs">3.1. Actionneurs et transducteurs (capteurs)<a href="#31-actionneurs-et-transducteurs-capteurs" class="hash-link" aria-label="Lien direct vers 3.1. Actionneurs et transducteurs (capteurs)" title="Lien direct vers 3.1. Actionneurs et transducteurs (capteurs)">​</a></h3>
<p>Pour s&#x27;interfacer avec l&#x27;environnement externe, divers composants électroniques sont utilisés, soit comme actionneurs (qui modifient l&#x27;état de l&#x27;environnement externe) soit comme transducteurs/capteurs (qui sont influencés par l&#x27;environnement externe et fournissent des informations au microcontrôleur sur différents paramètres).</p>
<p><strong>Exemples d&#x27;actionneurs</strong>:</p>
<ul>
<li>Ventilateurs</li>
<li>Indicateurs sonores - buzzers</li>
<li>Indicateurs lumineux</li>
<li>Résistances chauffantes</li>
</ul>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Parfois, un élément d&#x27;activation est nécessaire pour alimenter un actionneur. Par exemple, si nous voulons démarrer un moteur, le C n&#x27;envoie qu&#x27;une commande de démarrage logique à un transistor, qui s&#x27;ouvre ensuite et permet à un courant plus important de passer (ici, &quot;grand courant&quot; est relatif par rapport aux quelques milliampères qu&#x27;un C peut produire).</p></div></div>
<p><strong>Capteurs d&#x27;exemple</strong>:</p>
<ul>
<li>Boutons</li>
<li>Photorésistances - leur résistance électrique est influencée par la quantité de lumière</li>
<li>Thermistances - leur résistance électrique est influencée par la température</li>
</ul>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Selon le type de transducteur, le signal peut nécessiter un traitement avant d&#x27;être lu par le  µC (conditionnement du signal). Par exemple, une photorésistance doit être utilisée dans un diviseur de tension ou un circuit de source de courant, tandis qu&#x27;un bouton peut être connecté directement au microcontrôleur.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-led">3.1.1 LED<a href="#311-led" class="hash-link" aria-label="Lien direct vers 3.1.1 LED" title="Lien direct vers 3.1.1 LED">​</a></h4>
<p>Les LED - diodes électroluminescentes - émettent de la lumière lorsqu&#x27;elles sont polarisées vers l&#x27;avant. Ne les confondez pas avec les ampoules traditionnelles, car elles fonctionnent de manière fondamentalement différente.</p>
<p>Selon les semi-conducteurs utilisés dans leur construction et la lentille en plastique qui agit comme une lentille de dispersion et un filtre optique, les LED peuvent émettre de la lumière dans différentes couleurs. Ne confondez pas les LED avec les ampoules! Alors que les ampoules émettent de la lumière en chauffant un filament de tungstène à des températures élevées, les LED émettent de la lumière en passant du courant à travers un matériau semi-conducteur (jonction p-n).</p>
<p>Les LED peuvent être utilisées comme indicateurs d&#x27;état (souvent utilisés dans divers appareils pour signaler qu&#x27;un appareil est allumé et exécute une fonction) ou pour l&#x27;éclairage, où des LED de haute puissance sont utilisées. En laboratoire, les LED sont utilisées pour indiquer l&#x27;état d&#x27;une broche.</p>
<p>Calcul de la résistance limite de courant</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>remarque</div><div class="admonitionContent_BuS1"><p>Les LED sont des diodes, de sorte que le courant qui les traverse augmente de manière exponentielle avec la tension appliquée.</p></div></div>
<p>Pour utiliser une LED comme indicateur d&#x27;état pour une broche (plus précisément, pour indiquer la présence de tension), le courant à travers la LED doit être limité. La façon la plus simple de le faire est de placer une résistance en série avec la LED.</p>
<p>Une LED est conçue pour fonctionner à un courant nominal (par exemple, 10mA). La chute de tension à ce courant pour les LED indicatrices de faible puissance est déterminée par la chimie de la LED (qui détermine également sa couleur). En laboratoire, parce que nous utilisons des LED avec des exigences de courant si faibles, nous pouvons les alimenter directement à partir des broches logiques du C.</p>
<p>Le circuit utilisé est le suivant:</p>
<p><img decoding="async" loading="lazy" alt=" Circuit de travail et calcul de résistance de limitation de courant" src="/fr/assets/images/r_limit-f5e5fd5b3b2a2a99d50edebba2592626.png" width="995" height="723" class="img_ev3q"></p>
<p><strong>Solution</strong>: Si le microcontrôleur fonctionne à 5V et que nous voulons utiliser une LED rouge à 10mA, avec une chute de tension de 1,7V comme spécifié par le fabricant, nous devons utiliser une résistance de 330 ohms.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-boutons">3.1.2 Boutons<a href="#312-boutons" class="hash-link" aria-label="Lien direct vers 3.1.2 Boutons" title="Lien direct vers 3.1.2 Boutons">​</a></h4>
<p>La façon la plus simple pour un utilisateur d&#x27;interagir avec un microcontrôleur est d&#x27;utiliser des boutons. La façon correcte de connecter un bouton-poussoir dans ce laboratoire est montrée dans le diagramme ci-dessous:</p>
<p><img decoding="async" loading="lazy" alt=" Connexion d&amp;#39;un bouton-poussoir: a) incorrect, avec entrée flottante, b) correct, avec résistance de traction" src="/fr/assets/images/conectare_buton-1cca6542565f3f068e275c3c0a3b49fa.png" width="1920" height="1080" class="img_ev3q"></p>
<p>Raccordement d&#x27;un bouton-poussoir: a) incorrect, avec entrée flottante, b) correct, avec résistance de traction</p>
<p><strong>a)</strong> Affiche un bouton connecté à la broche PD0 du C. Lorsque le bouton est pressé, l&#x27;entrée PD0 sera connectée à GND, ce qui signifie qu&#x27;elle sera dans l&#x27;état logique &quot;0&quot;. Cette méthode de connexion est incorrecte car lorsque le bouton n&#x27;est pas pressé, l&#x27;entrée est dans un état <strong>non défini</strong> (comme si on la laissait flottante), elle ne serait pas connectée à GND ou Vcc!</p>
<p><strong>b)</strong> Affiche la bonne façon de connecter le bouton, en utilisant une <strong>résistance d&#x27;extraction</strong> entre la broche d&#x27;entrée et Vcc. Cette résistance garantit que l&#x27;entrée reste dans l&#x27;état logique &quot;1&quot; lorsque le bouton n&#x27;est pas pressé en &quot;tirant&quot; le potentiel de la ligne à Vcc. Alternativement, une <strong>résistance d&#x27;extraction</strong> (connectée à GND) peut être utilisée, auquel cas l&#x27;entrée est conservée dans l&#x27;état logique &quot;0&quot;.</p>
<p><strong>En laboratoire</strong>: Pour économiser de l&#x27;espace externe, dans l&#x27;ATmega328P C, ces résistances sont intégrées dans le circuit intégré. Initialement, elles sont désactivées et peuvent être activées via un logiciel.</p>
<p>3.2. Utilisation des registres</p>
<p>Cela peut être considéré comme l&#x27;étape la plus importante lors de l&#x27;utilisation d&#x27;un  µC. Nous devons apprendre à configurer le  µC en interne afin qu&#x27;il remplisse les fonctions que nous désirons. Dans ce laboratoire, nous allons configurer les broches pour fonctionner comme E / S: certaines broches liront s&#x27;il y a une tension (entrée), tandis que d&#x27;autres produiront 0 volts ou 5 volts en fonction de nos commandes logicielles.</p>
<p>Pour clarifier la terminologie : quand nous disons <strong>nous fixons un registre</strong> ou écrivons dans un registre, nous ne faisons pas référence aux registres à usage général dans le processeur avec lequel vous avez peut-être travaillé dans IOCLA. <strong>Nous faisons référence aux adresses mémoire</strong> réservées dans le  µC. Répétons ensemble: &quot;Par registre, nous entendons une adresse mémoire.&quot;</p>
<p>Chaque fois que vous avez besoin de configurer un périphérique, la meilleure source pour trouver les paramètres exacts et leurs fonctions est toujours la <a href="http://www.microchip.com/downloads/fr/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf" target="_blank" rel="noopener noreferrer">fiche d&#x27;information</a> de la  µC. Comme il n&#x27;est pas pratique d&#x27;écrire dans le code des adresses comme *(0x04)</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Pour écrire une valeur dans un registre, vous pouvez attribuer une valeur directement. Cependant, cette méthode ne rend pas le code très facile à comprendre. <em>Notre recommandation</em> est d&#x27;utiliser des masques de bits ((1  x)) ou la macro _BV(x). Nous recommandons également d&#x27;utiliser le nom de broche au lieu de son index, car les noms sont indicatifs de leur fonction (par exemple, dans le registre ADCSRA du convertisseur bit analogique-numérique).</p></div></div>
<hr>
<table><thead><tr><th>Operation</th><th>Syntax</th></tr></thead><tbody><tr><td>Set bit to 1</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro |= (1 &lt;&lt; bit_index)
</code></td></tr><tr><td>Set bit to 0</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro &amp;= ~(1 &lt;&lt; bit_index)
</code></td></tr><tr><td>Toggle bit</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro ^= (1 &lt;&lt; bit_index)
</code></td></tr><tr><td>Read bit</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro &amp; (1 &lt;&lt; bit_index)
</code></td></tr></tbody></table>
<p>Exemple : Utilisation des registres</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">// NOT RECOMMENDED.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Also not recommended, as it hardcodes the pin index.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> PB3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// RECOMMENDED.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_BV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PB3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// RECOMMENDED.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour plus de détails sur le travail avec les bits dans les registres, reportez-vous à la section tutoriel sur le <a href="https://ocw.cs.pub.ro/courses/pm/tutorial/biti" target="_blank" rel="noopener noreferrer">wiki</a>.</p>
<p>Ne vous inquiétez pas, nous aurons de nombreuses sessions de laboratoire pour vous habituer à travailler avec des registres et à configurer le C. Nous vous encourageons à faire des efforts dès maintenant au début pour un voyage plus facile tout au long du semestre.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-registres-des-es">3.3. Registres des E/S<a href="#33-registres-des-es" class="hash-link" aria-label="Lien direct vers 3.3. Registres des E/S" title="Lien direct vers 3.3. Registres des E/S">​</a></h3>
<p>Pour ce laboratoire, nous vous avons épargné la recherche dans la fiche technique, qui peut sembler compliquée au premier abord, et avons résumé les adresses mémoire (registres) que vous devez modifier pour compléter ce laboratoire.</p>
<p>Le microcontrôleur ATmega324 offre 4 ports d&#x27;E/S, chacun avec 8 broches. En interne, chaque port dispose de trois registres 8 bits qui permettent à l&#x27;utilisateur de contrôler <em>le flux de données au niveau de la broche</em>: vous pouvez écrire/lire des données depuis/vers le port respectif. Ces trois registres sont:</p>
<ul>
<li><strong><code>DDRn</code></strong> - <em>Registre des directions de données</em>
<ul>
<li>Définit la direction des broches de port</li>
<li>Si le bit <em>x</em> vaut <strong>0</strong>, la broche <em>x</em> vaut <strong>entrée</strong></li>
<li>Si le bit <em>x</em> vaut <strong>1</strong>, la broche <em>x</em> vaut <strong>sortie</strong></li>
</ul>
</li>
<li><strong><code>PORTn</code></strong> - <em>Registre des données</em>
<ul>
<li>Définit les valeurs de sortie des broches ou active/désactive les résistances de traction</li>
<li>Si le bit <em>x</em> vaut <strong>0</strong> :</li>
<li>Si la broche <em>x</em> est <strong>output</strong>, ce sera <strong>LOW</strong></li>
<li>Si la broche <em>x</em> est <strong>entrée</strong>, la résistance de traction sera <strong>désactivée</strong></li>
<li>Si le bit <em>x</em> est <strong>1</strong> :</li>
<li>Si la broche <em>x</em> est <strong>output</strong>, ce sera <strong>HIGH</strong></li>
<li>Si la broche <em>x</em> est <strong>entrée</strong>, la résistance de traction sera <strong>activée</strong></li>
</ul>
</li>
<li><strong><code>PINn</code></strong> - <em>Epingles d&#x27;entrée Adresse</em>
<ul>
<li>Si la broche est <strong>entrée</strong>, nous pouvons lire les données du port respectif</li>
<li>Si la broche <em>x</em> est <strong>LOW</strong>, alors le bit <em>x</em> sera <strong>0</strong></li>
<li>Si la broche <em>x</em> est <strong>HIGH</strong>, alors le bit <em>x</em> sera <strong>1</strong></li>
<li>Si la broche est <strong>output</strong>, nous pouvons la basculer automatiquement</li>
<li>Si nous écrivons <strong>1</strong> au bit <em>x</em>, le bit correspondant dans <strong><code>PORTn</code></strong> sera automatiquement inversé (fonction <strong>toggle</strong>)</li>
</ul>
</li>
</ul>
<p><em>n</em> peut être A, B, C ou D, selon le port sélectionné. <em>x</em> peut être compris entre 0 et 7.</p>
<p>Une description détaillée des ports et de leurs registres correspondants peut être trouvée dans la fiche technique ATmega324, dans le chapitre <em>Ports d&#x27;E/S</em>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="331-exemple-de-traitement-des-sorties">3.3.1 Exemple de traitement des sorties<a href="#331-exemple-de-traitement-des-sorties" class="hash-link" aria-label="Lien direct vers 3.3.1 Exemple de traitement des sorties" title="Lien direct vers 3.3.1 Exemple de traitement des sorties">​</a></h4>
<p>Supposons que nous ayons une LED connectée à la broche 1 du port B (appelée <code>PORTB1</code> ou <code>PB1</code>). Pour allumer ou éteindre la LED, procédez comme suit:</p>
<ul>
<li>Configurer la broche <code>PB1</code> comme sortie :<!-- -->
<ul>
<li>Le bit 1 (<code>PB1</code>) dans le registre <code>DDRB</code> doit être mis à 1</li>
<li><code>DDRB |= (1 &lt;&lt; PB1);</code></li>
</ul>
</li>
<li>Pour allumer la LED, réglez la broche <code>PB1</code> à <strong>HIGH</strong>:<!-- -->
<ul>
<li>Le bit 1 (PB1) dans le registre <code>PORTB</code> doit être réglé sur 1</li>
<li><code>PORTB |= (1 &lt;&lt; PB1);</code></li>
</ul>
</li>
<li>Pour désactiver la LED, réglez la broche <code>PB1</code> sur <strong>LOW</strong>:<!-- -->
<ul>
<li>Le bit 1 (<code>PB1</code>) dans le registre <code>PORTB</code> doit être mis à 0</li>
<li><code>PORTB &amp;= ~(1 &lt;&lt; PB1);</code></li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="332-exemple-de-traitement-des-entrées">3.3.2. Exemple de traitement des entrées<a href="#332-exemple-de-traitement-des-entrées" class="hash-link" aria-label="Lien direct vers 3.3.2. Exemple de traitement des entrées" title="Lien direct vers 3.3.2. Exemple de traitement des entrées">​</a></h4>
<p>Supposons que nous ayons un bouton connecté à la broche 4 du port D (appelé <code>PORTD4</code> ou <code>PD4</code>), en utilisant la connexion correcte du cas <strong>b)</strong> montré précédemment. Pour déterminer l&#x27;état du bouton (appuyé ou libéré), procédez comme suit:</p>
<ul>
<li>Configurer la broche <code>PD4</code> comme entrée :<!-- -->
<ul>
<li>Le bit 4 (<code>PD4</code>) dans le registre DDRD doit être mis à 0</li>
<li><code>DDRD &amp;= ~(1 &lt;&lt; PD4);</code></li>
</ul>
</li>
<li>Pour déterminer si le bouton est pressé, lisez la valeur de la broche à laquelle il est attaché. Il sera 1 lorsque le bouton est relâché et 0 lorsque le bouton est pressé:<!-- -->
<ul>
<li>Lire le bit 4 (<code>PD4</code>) dans le registre <code>PIND</code>:</li>
<li><code>char val = PIND &amp; (1 &lt;&lt; PD4);</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-développer-des-programmes-pour-avr">4. Développer des programmes pour AVR<a href="#4-développer-des-programmes-pour-avr" class="hash-link" aria-label="Lien direct vers 4. Développer des programmes pour AVR" title="Lien direct vers 4. Développer des programmes pour AVR">​</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Développement et compilation sans PlatformIO </summary><div><div class="collapsibleContent_i85q"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-développement-et-compilation">4.1. Développement et compilation<a href="#41-développement-et-compilation" class="hash-link" aria-label="Lien direct vers 4.1. Développement et compilation" title="Lien direct vers 4.1. Développement et compilation">​</a></h3><p>Pour le développement de programmes, nous pouvons utiliser n&#x27;importe quel éditeur de texte.</p><p>Dans les laboratoires, nous écrirons le code C, pas l&#x27;assemblage (AVRASM), en utilisant le compilateur <a href="https://gcc.gnu.org/wiki/avr-gcc" target="_blank" rel="noopener noreferrer">avr-gcc</a>. WinAVR inclut la bibliothèque C, avr-libc, qui doit être installée sur les systèmes Linux et Windows (<a href="http://winavr.sourceforge.net/" target="_blank" rel="noopener noreferrer">WinAVR</a>.</p><p><img decoding="async" loading="lazy" alt="Compilation Process with AVR-GCC" src="/fr/assets/images/procesul_de_compilare-81b7f35e0e3f478577e22db2b3ac9452.jpg" width="834" height="303" class="img_ev3q"></p><p>Bien que notre microcontrôleur soit 8 bits, en code C, nous pouvons utiliser des variables entières de 16/32/64 bits et même des nombres à virgule flottante. Le compilateur gère la traduction des instructions en code d&#x27;assemblage qui fonctionne sur une architecture 8 bits.</p><p>Comme pour les systèmes Linux, pour programmer AVR, nous avons besoin de quelques utilitaires : le compilateur avr-gcc, avr-libc et AVRDUDE. Pour installer ces utilitaires, Homebrew est recommandé. Utilisez les commandes suivantes :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install avrdude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xcode-select --install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew tap osx-cross/avr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install avr-gcc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour fonctionner sur les processeurs M1/M2/M3, vous devez installer au moins la version 11 d&#x27;avr-gcc.
Plus d&#x27;exemples peuvent être trouvés <a href="https://wellys.com/posts/avr_c_macos/" target="_blank" rel="noopener noreferrer">ici</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-programmation-du-microcontrôleur">4.2. Programmation du microcontrôleur<a href="#42-programmation-du-microcontrôleur" class="hash-link" aria-label="Lien direct vers 4.2. Programmation du microcontrôleur" title="Lien direct vers 4.2. Programmation du microcontrôleur">​</a></h3><p>Un microcontrôleur peut être programmé en utilisant diverses méthodes, telles que la programmation d&#x27;interface série, un programmeur ISP (In-System Programming) en utilisant l&#x27;interface SPI, ou un bootloader.</p><p>Dans ce laboratoire, nous utiliserons la dernière méthode car elle élimine le besoin de composants externes supplémentaires pour télécharger le fichier hexadécimal. Un <strong>bootloader</strong> est un programme préchargé (utilisant, par exemple, un programmeur FAI) à la fin de la mémoire du programme du microcontrôleur. L&#x27;exécution du code téléchargé commencera à partir de la section de démarrage. L&#x27;inconvénient de cette méthode est l&#x27;espace mémoire occupé par le bootloader.</p><p><img decoding="async" loading="lazy" alt="Exécution de programmes à l&amp;#39;aide d&amp;#39;un bootloader" src="/fr/assets/images/avr_bootloader_model-4d2cf809b45926c332eacfb42a34c4e3.jpg" width="392" height="338" class="img_ev3q"></p><p>L&#x27;utilisation d&#x27;un bootloader nécessite de remplir une condition au démarrage du microcontrôleur. Sur les cartes de laboratoire, il s&#x27;exécute sur chaque RESET, mais nous pouvons définir n&#x27;importe quelle condition détectable par le processeur (par exemple, si un bouton est pressé ou non). Certains microcontrôleurs ont une ROM dédiée pour le bootloader, installée en usine (par exemple, STM32).</p><p>Pour télécharger le programme sur le microcontrôleur, nous devons utiliser un utilitaire sur l&#x27;ordinateur. Ci-dessous un exemple d&#x27;utilisation de l&#x27;utilitaire <strong>vrdude</strong> sur Linux et Windows:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ avrdude -c arduino -P /dev/ttyUSB0 -b 57600 -p atmega324p -U flash:w:lab0.hex:a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:/&gt; avrdude -c arduino -P COM12 -b 57600 -p atmega324p -U flash:w:lab0.hex:a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-platformio">4.3. PlatformIO<a href="#43-platformio" class="hash-link" aria-label="Lien direct vers 4.3. PlatformIO" title="Lien direct vers 4.3. PlatformIO">​</a></h3>
<p>Pour une solution <strong>toolchain et IDE</strong> tout-en-un, installez <a href="https://platformio.org/" target="_blank" rel="noopener noreferrer">PlatformIO</a>. Après avoir installé l&#x27;extension PlatformIO dans VSCode, créez un nouveau projet ciblant ATmega324P en tant que plate-forme/microcontrôleur et ajoutez la ligne suivante à <strong>platformio.ini</strong> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> upload_protocol = urclock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Alternative à PlatformIO </summary><div><div class="collapsibleContent_i85q"><p>4.3.1 Alternative à PlatformIO : Installation séparée de la chaîne d&#x27;outils avr-gcc</p><p>D&#x27;accord, vous êtes un développeur de logiciels hardcore et vous voulez installer la chaîne d&#x27;outils directement à l&#x27;aide de votre IDE préféré (qui est-ce que je plaisante, vous travaillez directement dans Vim). Vous avez cette option aussi, mais il vient avec quelques maux de tête. Si vous voulez installer juste la chaîne d&#x27;outils, sans un IDE, vous aurez besoin <strong>avr-gcc</strong>, <strong>make</strong> et <strong>avrdude</strong> pour compiler et programmer les guides de développement.</p><ul>
<li><a href="https://baremetalmicro.com/tutorial_avr_toolchain/03-Install-on-Ubuntu-Linux.html" target="_blank" rel="noopener noreferrer">Linux</a></li>
<li><a href="https://tinusaur.com/guides/avr-gcc-toolchain/" target="_blank" rel="noopener noreferrer">Windows</a></li>
<li><a href="https://wellys.com/posts/avr_c_macos/" target="_blank" rel="noopener noreferrer">Mac</a></li>
</ul><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Il est possible que l&#x27;installation par défaut d&#x27;avrdude ne prenne pas en charge le bootloader <strong>urclock</strong> sur la carte, et que vous receviez un message d&#x27;erreur lors de l&#x27;exécution de <strong>make upload</strong>. Pour résoudre ce problème, vous devez installer avrdude 7.2-arduino.1 (ou installer PlatformIO directement, qui est livré avec la version correcte d&#x27;avrdude).</p></div></div><p>Nous vous recommandons également d&#x27;utiliser un IDE pour le développement de code. Si vous préférez VSCode (sans l&#x27;extension PlatformIO), consultez ce <a href="https://www.youtube.com/watch?vLE7-uzhlGVM&amp;ab_channelWhiteHeart" target="_blank" rel="noopener noreferrer">tutorial</a>.</p><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>attention</div><div class="admonitionContent_BuS1"><p><strong>Avertissement</strong>: Support du programmeur urclock (également connu sous le nom de urprotocol), utilisé par nos cartes, <a href="https://github.com/avrdudes/avrdude/Windows/main/NEWS" target="_blank" rel="noopener noreferrer">a été seulement ajouté</a> dans avrdudeSystem &gt; 7.1. Assurez-vous de ne pas installer une version récente (par exemple, <strong>7.3</strong>).</p></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-bonjour-tout-le-monde-hello-world">4.4. Bonjour tout le monde (Hello World)<a href="#44-bonjour-tout-le-monde-hello-world" class="hash-link" aria-label="Lien direct vers 4.4. Bonjour tout le monde (Hello World)" title="Lien direct vers 4.4. Bonjour tout le monde (Hello World)">​</a></h3>
<p>Nous écrirons un programme qui active et désactive une LED à des intervalles de 500 ms. La LED ciblée est la LED verte sur la carte du laboratoire. Ceci se fait en modifiant la tension d&#x27;une des broches du microcontrôleur, dans notre cas, la broche 7 du port D (<code>PD7</code>).</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;avr/io.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;util/delay.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Set pin 7 of port D as an output. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DDRD </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> PD7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Toggle the state of the pin. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PORTD </span><span class="token operator" style="color:#393A34">^=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> PD7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_delay_ms</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour compiler avec PlatformIO, appuyez sur <strong>Ctrl+Alt+B</strong>, puis <strong>Ctrl+Alt+U</strong> pour télécharger.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Utilisation d&#x27;un Makefile personnalisé pour la compilation </summary><div><div class="collapsibleContent_i85q"><p>Si vous avez installé la chaîne d&#x27;outils séparément, vous devez utiliser le Makefile suivant :</p><div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PORT ?= /dev/ttyUSB0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#PORT ?= COM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all: main.hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main.hex: main.elf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avr-objcopy  -j .text -j .data -O ihex $^ $@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avr-size main.elf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main.elf: main.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avr-gcc -mmcu=atmega324p -DF_CPU=12000000 -Os -Wall -o $@ $^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upload: main.hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avrdude -c urclock -P $(PORT) -b 57600 -p atmega324p -D -xnometadata -U flash:w:$&lt;:a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm -rf main.elf main.hex</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Le compilateur utilisé est <strong>avr-gcc</strong>. Les drapeaux ont les significations suivantes :</p><ul>
<li>-<code>mmcu</code> : Informe le compilateur du type de microcontrôleur pour lequel le code doit être généré.</li>
<li>-<code>DF_CPU12000000</code> : Définit la macro F_CPU, qui indique la fréquence d&#x27;horloge du microcontrôleur.</li>
<li>-<code>Os</code>: Optimise le programme pour l&#x27;utilisation de la mémoire (assez utile compte tenu de la mémoire limitée sur la puce).</li>
<li>-<code>Wall</code> : active tous les messages d&#x27;avertissement.</li>
</ul><p>Le fichier à programmer sur la carte doit être au format <em>ihex</em>. Par conséquent, il est nécessaire d&#x27;extraire les données et les sections de code du fichier ELF compilé et de les intégrer dans un fichier <em>ihex</em>. Cette étape est effectuée à l&#x27;aide de l&#x27;utilitaire <strong>avr-objcopy</strong>.</p><p>La commande <strong>avr-size</strong> indique la quantité de mémoire occupée par les différentes sections du programme. Gardez à l&#x27;esprit que dans la mémoire SRAM pour les données, outre la section .data, la pile sera également placée. Pour exécuter le programme sur le microcontrôleur ATmega324, la section .text doit être inférieure à 32 Ko, et la section .data doit être inférieure à 2 Ko.</p></div></div></div></div></details>
<p>Le résultat de la compilation est le fichier <strong>main.hex</strong>. Ce fichier est ensuite téléchargé sur le microcontrôleur à l&#x27;aide de la règle <strong>upload</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-exercices">5. Exercices<a href="#5-exercices" class="hash-link" aria-label="Lien direct vers 5. Exercices" title="Lien direct vers 5. Exercices">​</a></h2>
<p><strong>Tâche 0</strong> Commençons par vérifier la configuration.</p>
<ul>
<li>Installez votre IDE préféré / requis et exécutez l&#x27;exemple Hello World sur la carte de développement dans le laboratoire.</li>
</ul>
<p><strong>Tâche 1</strong></p>
<ul>
<li>Modifiez l&#x27;exemple Hello World pour que la LED allumée soit rouge au lieu de verte. Conseil : Trouvez la broche et le port auxquels cette LED (qui fait partie de la LED RGB) est connectée dans le <a href="https://raw.githubusercontent.com/dantudose/PM-Board/main/Hardware/schematic.pdf" target="_blank" rel="noopener noreferrer">schéma de la carte</a> / <a href="https://github.com/dose" target="_blank" rel="noopener noreferrer">documentation du tableau sur GitHub</a>.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Remarque</strong>: La LED RVB a une anode commune, donc l&#x27;écriture d&#x27;un 1 logique sur la broche GPIO correspondante éteint la LED.</p></div></div>
<p><strong>Tâche 2</strong></p>
<ul>
<li>Modifier l&#x27;exemple Bonjour le monde de sorte que la LED change de couleur lorsque le bouton 1 (<code>PB2</code>) est pressé.</li>
<li>Gardez la LED verte allumée par défaut.</li>
<li>Configurer les registres pour définir <code>PB2</code> comme entrée.</li>
<li>Configurez la LED pour ajouter une autre couleur (rouge/bleu) lorsque vous appuyez sur le bouton. (N&#x27;oubliez pas d&#x27;activer la résistance de traction interne du  µC pour <code>PB2</code>).</li>
</ul>
<p><strong>Tâche 3</strong></p>
<ul>
<li>À partir de l&#x27;application créée dans la tâche 2, modifiez la fonctionnalité du bouton 1 pour parcourir les couleurs LED sur des pressions successives (première pression - rouge, deuxième pression - vert, troisième pression - bleu, etc.).</li>
<li>Utilisez le bouton 2 pour basculer entre une LED clignotante (clignotement) et un état solide (une pression - clignotement, deuxième pression - toujours allumée, pression suivante - clignote à nouveau, etc.).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-liens-utiles">6. Liens utiles<a href="#6-liens-utiles" class="hash-link" aria-label="Lien direct vers 6. Liens utiles" title="Lien direct vers 6. Liens utiles">​</a></h2>
<ul>
<li><a href="http://www.avrfreaks.net/" target="_blank" rel="noopener noreferrer">AVR Freaks Community</a></li>
<li><a href="http://www.nongnu.org/avr-libc/user-manual/modules.html" target="_blank" rel="noopener noreferrer">Documentation AVR libc</a></li>
<li><a href="https://gcc.gnu.org/wiki/avr-gcc" target="_blank" rel="noopener noreferrer">Compilateur AVR GCC</a></li>
<li><a href="http://hackaday.com/2010/10/23/avr-programming-introduction/" target="_blank" rel="noopener noreferrer">Détails d&#x27;introduction sur la programmation AVR (Blog)</a></li>
<li><a href="http://electronics.howstuffworks.com/led.htm" target="_blank" rel="noopener noreferrer">Comment fonctionnent les LED</a></li>
<li><a href="https://raw.githubusercontent.com/dantudose/PM-Board/main/Hardware/schematic.pdf" target="_blank" rel="noopener noreferrer">Schématique du Conseil de développement du PM</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/fr/lab"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Info General Labo</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fr/lab/lab01"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Laboratoire 1 : USART. Débogage</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-introduction" class="table-of-contents__link toc-highlight">1. Introduction</a><ul><li><a href="#11-pourquoi-" class="table-of-contents__link toc-highlight">1.1. Pourquoi ?</a></li><li><a href="#12-quest-ce-quun-microcontrôleur-µc-" class="table-of-contents__link toc-highlight">1.2. Qu&#39;est-ce qu&#39;un microcontrôleur (µC) ?</a></li><li><a href="#13-µc-dans-la-nature" class="table-of-contents__link toc-highlight">1.3. µC dans la nature</a></li><li><a href="#14-quy-a-t-il-à-lintérieur-dun-µc-" class="table-of-contents__link toc-highlight">1.4. Qu’y a-t-il à l’intérieur d’un µC ?</a></li></ul></li><li><a href="#2-micropuce-atmel-avr" class="table-of-contents__link toc-highlight">2. Micropuce (Atmel) AVR</a><ul><li><a href="#21-atmega324p" class="table-of-contents__link toc-highlight">2.1. ATmega324P</a></li><li><a href="#22-la-carte-de-development-du-laboratoire" class="table-of-contents__link toc-highlight">2.2. La Carte de development du laboratoire</a></li><li><a href="#23-pinout-de-la-carte" class="table-of-contents__link toc-highlight">2.3. Pinout de la carte</a></li></ul></li><li><a href="#3-mettons-nous-au-travail" class="table-of-contents__link toc-highlight">3. Mettons-nous au travail</a><ul><li><a href="#31-actionneurs-et-transducteurs-capteurs" class="table-of-contents__link toc-highlight">3.1. Actionneurs et transducteurs (capteurs)</a></li><li><a href="#33-registres-des-es" class="table-of-contents__link toc-highlight">3.3. Registres des E/S</a></li></ul></li><li><a href="#4-développer-des-programmes-pour-avr" class="table-of-contents__link toc-highlight">4. Développer des programmes pour AVR</a><ul><li><a href="#41-développement-et-compilation" class="table-of-contents__link toc-highlight">4.1. Développement et compilation</a></li><li><a href="#42-programmation-du-microcontrôleur" class="table-of-contents__link toc-highlight">4.2. Programmation du microcontrôleur</a></li><li><a href="#43-platformio" class="table-of-contents__link toc-highlight">4.3. PlatformIO</a></li><li><a href="#44-bonjour-tout-le-monde-hello-world" class="table-of-contents__link toc-highlight">4.4. Bonjour tout le monde (Hello World)</a></li></ul></li><li><a href="#5-exercices" class="table-of-contents__link toc-highlight">5. Exercices</a></li><li><a href="#6-liens-utiles" class="table-of-contents__link toc-highlight">6. Liens utiles</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/pm" target="_blank" rel="noopener noreferrer" class="footer__link-item">UPB Open CourseWare <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Politehnica Bucharest. <br> This pages are the translated and adapted version from https://ocw.cs.pub.ro/courses/pm</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper plugin-docs plugin-id-lab docs-version-current docs-doc-page docs-doc-id-lab00/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Laboratory 0: Introductory Applications | Microprocessor Architecture</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://upb-fils-am-fr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://upb-fils-am-fr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://upb-fils-am-fr.github.io/lab/lab00"><meta data-rh="true" property="og:locale" content="en_GB"><meta data-rh="true" property="og:locale:alternate" content="fr"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-lab-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-lab-current"><meta data-rh="true" property="og:title" content="Laboratory 0: Introductory Applications | Microprocessor Architecture"><meta data-rh="true" name="description" content="Useful chapters from ATmega324P Datasheet"><meta data-rh="true" property="og:description" content="Useful chapters from ATmega324P Datasheet"><link data-rh="true" rel="icon" href="/img/sigla_am.ico"><link data-rh="true" rel="canonical" href="https://upb-fils-am-fr.github.io/lab/lab00"><link data-rh="true" rel="alternate" href="https://upb-fils-am-fr.github.io/lab/lab00" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://upb-fils-am-fr.github.io/fr/lab/lab00" hreflang="fr"><link data-rh="true" rel="alternate" href="https://upb-fils-am-fr.github.io/lab/lab00" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f442cfaf.css">
<script src="/assets/js/runtime~main.0d1b28b0.js" defer="defer"></script>
<script src="/assets/js/main.b9382a7a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/sigla_am.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sigla_am.svg" alt="Microprocessor Architecture" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/sigla_am.svg" alt="Microprocessor Architecture" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Microprocessor Architecture</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/lab">Lab</a><a class="navbar__item navbar__link" href="/project">Project</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/lab/lab00" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li><li><a href="/fr/lab/lab00" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="fr">Fran√ßais</a></li></ul></div><a href="https://github.com/UPB-FILS-AM-FR/am-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab">General Lab Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/lab/lab00">Laboratory 0: Introductory Applications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab/lab01">Laboratory 1: USART. Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab/lab02">Laboratory 2: Interrupts, Timers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab/lab03">Lab 3: Timers, Pulse Width Modulation (PWM)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab/lab04">Lab 4: Analog to Digital Converter (ADC)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab/lab05">Lab 5: SPI (Serial Peripheral Interface)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lab/lab06">Lab 6: I2C (Inter-Integrated Circuit)</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Laboratory 0: Introductory Applications</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Laboratory 0: Introductory Applications</h1></header>
<p><strong>Useful chapters from</strong> <strong><a href="https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf" target="_blank" rel="noopener noreferrer">ATmega324P Datasheet</a></strong></p>
<ul>
<li>
<ol>
<li>Pin Configurations - page 15</li>
</ol>
</li>
<li>
<ol start="13">
<li>I/O-Ports - page 95</li>
</ol>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-introduction">1. Introduction<a href="#1-introduction" class="hash-link" aria-label="Direct link to 1. Introduction" title="Direct link to 1. Introduction">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-why">1.1. Why?<a href="#11-why" class="hash-link" aria-label="Direct link to 1.1. Why?" title="Direct link to 1.1. Why?">‚Äã</a></h3>
<p><strong>Q</strong>: What are we doing here? Where is what we learn used? Is it really useful?</p>
<p><strong>A</strong>: To answer briefly: &quot;a lot,&quot; &quot;everywhere,&quot; and &quot;yes&quot;; but let‚Äôs start with an example.</p>
<p>You‚Äôve just built a new PC and installed RGB lighting on the RAM, fans, and case‚Äîa lot of it. Now comes the question: who &quot;presses&quot; the buttons to make the colors appear as set in the software? Should the CPU sit and handle changing the colors? That would be a waste of resources. This is where a microcontroller comes in! It&#x27;s a smaller, simpler processor with a well-defined task within the system. In this case, its job is to control the RGB lighting throughout its lifetime.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-what-is-a-microcontroller-¬µc">1.2. What is a microcontroller (¬µC)?<a href="#12-what-is-a-microcontroller-¬µc" class="hash-link" aria-label="Direct link to 1.2. What is a microcontroller (¬µC)?" title="Direct link to 1.2. What is a microcontroller (¬µC)?">‚Äã</a></h3>
<p>TLDR: A computer in a chip. More specifically, it is an integrated circuit that includes a processing unit (CPU), memory (volatile RAM, non-volatile EEPROM, Flash, ROM), and various peripherals that allow it to communicate with the external environment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-¬µc-in-the-wild">1.3. ¬µC in the Wild<a href="#13-¬µc-in-the-wild" class="hash-link" aria-label="Direct link to 1.3. ¬µC in the Wild" title="Direct link to 1.3. ¬µC in the Wild">‚Äã</a></h3>
<p>We find them in various devices such as phones, household appliances, satellites, airplanes, factories, etc. There is a wide range of microcontrollers available, selected based on the application, primarily considering cost and energy consumption optimization for the device where the ¬µC will be used.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Example projects</summary><div><div class="collapsibleContent_i85q"><p><img decoding="async" loading="lazy" alt="projects" src="/assets/images/projects-cadd216f930c366a37303d3a9e0f65b7.png" width="1066" height="395" class="img_ev3q"></p><ul>
<li><a href="https://www.northstarst.com/" target="_blank" rel="noopener noreferrer">[1, 2] - Bird tracking</a></li>
<li><a href="http://www.rcgroups.com/forums/showthread.php?t=1335765" target="_blank" rel="noopener noreferrer">[3] - Palm size quad-copter</a></li>
<li>[4] - Line-following robot (Tare N&#x27; BarƒÉ)</li>
<li>[5] - Soccer-playing robot (IronFoot)</li>
<li>[6] - Submarine robot (R0X1)</li>
<li><a href="http://www.instructables.com/id/Easy-build-self-balancing-skateboardrobotsegway-/" target="_blank" rel="noopener noreferrer">[7] - Self-balancing skateboard</a></li>
</ul><p>For more examples, you can start searching here: <a href="https://www.hackster.io/projects/tags/microcontroller" target="_blank" rel="noopener noreferrer">https://www.hackster.io/projects/tags/microcontroller</a></p></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-whats-inside-a-¬µc">1.4. What‚Äôs Inside a ¬µC?<a href="#14-whats-inside-a-¬µc" class="hash-link" aria-label="Direct link to 1.4. What‚Äôs Inside a ¬µC?" title="Direct link to 1.4. What‚Äôs Inside a ¬µC?">‚Äã</a></h3>
<ul>
<li><strong>Central Processing Unit</strong> (¬µP core) with architectures of 8, 16, 32, or 64 bits</li>
<li>Volatile data memory (<strong>RAM</strong>) and/or non-volatile memory (Flash or EEPROM)</li>
<li>Non-volatile program memory (<strong>Flash</strong> or <strong>EEPROM</strong>)</li>
<li>General-purpose digital input-output ports (<strong>GPIO</strong> - General Purpose Input Output)</li>
<li>Serial communication interfaces (<strong>USART</strong>, <strong>SPI</strong>, <strong>I2C</strong>, PCM, <strong>USB</strong>, SDIO, etc.)</li>
<li>Ethernet interfaces</li>
<li>Interfaces for graphic displays (LVDS, <strong>HDMI</strong>, or other dedicated LCD control protocols)</li>
<li>Timers (internal or used for generating periodic signals - e.g., PWM - or as a watchdog)</li>
<li>Analog-to-digital and digital-to-analog converters (<strong>ADC</strong>, <strong>DAC</strong>), analog front-ends, and other circuits for analog signals</li>
<li>Integrated voltage source</li>
<li>Programming and debugging interface</li>
</ul>
<p><strong>Peripherals</strong> represent any internal or external device that connects to a computing system and extends its basic functionality. In the case of a microcontroller, several such peripherals are integrated directly into the chip (examples above). Although they do not resemble PC peripherals (monitor, graphics card, keyboard, mouse, etc.), without them, the microcontroller would not be able to interact with the outside world. Moreover, peripherals help connect more advanced components to the controller and provide functionalities similar to a PC system (internet connection, USB data line, graphic display, etc.).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-microchip-atmel-avr">2. Microchip (Atmel) AVR<a href="#2-microchip-atmel-avr" class="hash-link" aria-label="Direct link to 2. Microchip (Atmel) AVR" title="Direct link to 2. Microchip (Atmel) AVR">‚Äã</a></h2>
<p>Throughout the semester, we will work with microcontrollers from the AVR family by Microchip. These have an 8-bit Harvard architecture and a reduced instruction set (RISC).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-atmega324p">2.1. ATmega324P<a href="#21-atmega324p" class="hash-link" aria-label="Direct link to 2.1. ATmega324P" title="Direct link to 2.1. ATmega324P">‚Äã</a></h3>
<p><img decoding="async" loading="lazy" alt="ATmega324P" src="/assets/images/atmel-atmega324p-20pu-68e7d21082aaadc88b29af54b5215b74.jpg" width="640" height="640" class="img_ev3q"></p>
<p>This is an 8-bit microcontroller from the megaAVR family, which we will use throughout the semester. Its registers and internal data bus are 8-bit wide.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> ¬µC Specifications </summary><div><div class="collapsibleContent_i85q"><ul>
<li>32 KB Flash (determines the maximum program size)</li>
<li>1 KB EEPROM</li>
<li>2 KB RAM</li>
<li>20 MHz maximum clock frequency</li>
<li>Supply voltage between 2.7V and 5.5V</li>
<li>6 PWM channels</li>
<li>8 ADC channels with 10-bit resolution</li>
<li>4 digital I/O ports, each with 8 pins, totaling 32 I/O pins</li>
<li>3 timers (two 8-bit and one 16-bit)</li>
<li>Serial communication interfaces: USART, SPI, TWI</li>
<li>ISP programming interface and JTAG debugging interface</li>
</ul></div></div></details>
<p>We will learn to configure its pins and interact with the external environment through code. This microcontroller has 40 pins (shown below), of which 5 are for power or auxiliary functions, while 32 are for I/O. It has four ports: A, B, C, and D.</p>
<p><img decoding="async" loading="lazy" alt="ATmega324P Pin Configuration" src="/assets/images/atmega324pins-c8dc52d6a8794d0a4ded4788301bfaa6.png" width="842" height="726" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For more details, you can always consult the <a href="https://www.microchip.com/downloads/en/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf" target="_blank" rel="noopener noreferrer">datasheet</a> (the summarized technical documentation) of the microcontroller. :)</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-laboratory-board">2.2. Laboratory Board<a href="#22-laboratory-board" class="hash-link" aria-label="Direct link to 2.2. Laboratory Board" title="Direct link to 2.2. Laboratory Board">‚Äã</a></h3>
<p><a href="https:*github.com/dantudose/PM-Board" target="_blank" rel="noopener noreferrer">The Laboratory Board</a> is based on the <a href="https:*ww1.microchip.com/downloads/aemDocuments/documents/OTH/ProductDocuments/DataSheets/ATmega164P-324P-644P-Data-Sheet-40002071A.pdf" target="_blank" rel="noopener noreferrer">ATmega324P microcontroller</a> and comes with the following features:</p>
<ul>
<li>LSM9DS0 - 9-axis inertial sensor (accelerometer, gyroscope, and magnetometer)</li>
<li>MPL3115 - Barometric altimeter sensor</li>
<li>Temperature and ambient light sensors</li>
<li>128x160 ST7735 color LCD display with SD card reader</li>
<li>RGB LED</li>
<li>16x2 character LCD display</li>
<li>GPIO LEDs and buttons</li>
<li>JTAG and ISP connectors</li>
<li>Programmable USB interface and data interface</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/placuta-53a4f6f26ddb1097302ba7c6fa988f2a.png" width="451" height="295" class="img_ev3q"></p>
<p>The laboratory board is a circuit that conveniently provides access to the ¬µC‚Äôs pins and contains power, protection circuits, and possibly the ¬µC programmer.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The programmer is a special chip, sometimes even another microcontroller, responsible for loading the code into the ¬µC‚Äôs memory. We cannot directly connect the ¬µC to a PC‚Äôs USB lines; we need an intermediary to &quot;translate&quot; that information.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-development-board-pinout">2.3. Development Board Pinout<a href="#23-development-board-pinout" class="hash-link" aria-label="Direct link to 2.3. Development Board Pinout" title="Direct link to 2.3. Development Board Pinout">‚Äã</a></h3>
<p><strong>LCD Displays</strong></p>
<div style="display:flex;gap:20px;align-items:flex-start"><div style="flex:1"><table><thead><tr><th>Character LCD</th><th>GPIO Pin</th></tr></thead><tbody><tr><td>RS</td><td>PC0</td></tr><tr><td>RW</td><td>PC1</td></tr><tr><td>EN</td><td>PC2</td></tr><tr><td>D4</td><td>PC3</td></tr><tr><td>D5</td><td>PC4</td></tr><tr><td>D6</td><td>PC5</td></tr><tr><td>D7</td><td>PC6</td></tr><tr><td>Backlight</td><td>PC7</td></tr></tbody></table> </div><div style="flex:1"><table><thead><tr><th>Graphical LCD</th><th>GPIO Pin</th></tr></thead><tbody><tr><td>CS</td><td>PB0</td></tr><tr><td>RST</td><td>PB1</td></tr><tr><td>A0</td><td>PB4</td></tr><tr><td>SDA</td><td>PB5</td></tr><tr><td>SCK</td><td>PB7</td></tr><tr><td>Backlight</td><td>PA7</td></tr></tbody></table> </div></div>
<div style="display:flex;gap:20px;align-items:flex-start"><div style="flex:1"><p><strong>I2C Sensors &amp; Bus Addresses</strong></p>
<table><thead><tr><th>I2C</th><th>GPIO Pin</th><th>Chip</th><th>Address</th></tr></thead><tbody><tr><td>I2C Enable</td><td>PA6</td><td>LSM9DS0</td><td>0x1D (XM) 0x6B (G)</td></tr><tr><td>SCL</td><td>PC0</td><td>MPL3115A2</td><td>0x60</td></tr><tr><td>SDA</td><td>PC1</td><td></td><td></td></tr></tbody></table> </div><div style="flex:1"><p><strong>SD Card</strong></p>
<table><thead><tr><th></th><th>GPIO Pin</th></tr></thead><tbody><tr><td>CS</td><td>PA2</td></tr><tr><td>MOSI</td><td>PB5</td></tr><tr><td>MISO</td><td>PB6</td></tr><tr><td>SCK</td><td>PB7</td></tr></tbody></table> </div></div>
<div style="display:flex;gap:20px;align-items:flex-start"><div style="flex:1"><p><strong>RGB LED</strong></p>
<table><thead><tr><th></th><th>GPIO Pin</th></tr></thead><tbody><tr><td>Red</td><td>PD5</td></tr><tr><td>Green</td><td>PD7</td></tr><tr><td>Blue</td><td>PB3</td></tr></tbody></table> </div><div style="flex:1"><p><strong>Miscellaneous</strong></p>
<table><thead><tr><th></th><th>GPIO Pin</th></tr></thead><tbody><tr><td>Temperature Sensor</td><td>PA0</td></tr><tr><td>Ambient Light Sensor</td><td>PA1</td></tr><tr><td>Buttons (BTN1 - 6)</td><td>PA5</td></tr><tr><td>BTN 1</td><td>PB2</td></tr><tr><td>BTN 2</td><td>PD6</td></tr><tr><td>Speaker</td><td>PD4</td></tr></tbody></table> </div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-lets-get-to-work">3. Let&#x27;s get to work<a href="#3-lets-get-to-work" class="hash-link" aria-label="Direct link to 3. Let&#x27;s get to work" title="Direct link to 3. Let&#x27;s get to work">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-actuators-and-transducers-sensors">3.1. Actuators and Transducers (Sensors)<a href="#31-actuators-and-transducers-sensors" class="hash-link" aria-label="Direct link to 3.1. Actuators and Transducers (Sensors)" title="Direct link to 3.1. Actuators and Transducers (Sensors)">‚Äã</a></h3>
<p>To interface with the external environment, various electronic components are used, either as actuators (which modify the external environment&#x27;s state) or as transducers/sensors (which are influenced by the external environment and provide information to the microcontroller about different parameters).</p>
<p><strong>Example Actuators</strong>:</p>
<ul>
<li>Fans</li>
<li>Sound indicators - buzzers</li>
<li>Light indicators</li>
<li>Heating resistors</li>
</ul>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Sometimes, an activation element is needed to power an actuator. For example, if we want to start a motor, the ¬µC only sends a logical start command to a transistor, which then opens and allows a larger current to pass through (here, &quot;large current&quot; is relative compared to the few milliamps a ¬µC can output).</p></div></div>
<p><strong>Example Sensors</strong>:</p>
<ul>
<li>Buttons</li>
<li>Photoresistors - their electrical resistance is influenced by the amount of light</li>
<li>Thermistors - their electrical resistance is influenced by temperature</li>
</ul>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Depending on the type of transducer, the signal might need processing before it can be read by the ¬µC (signal conditioning). For example, a photoresistor must be used in a voltage divider or current source circuit, while a button can be connected directly to the microcontroller.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-leds">3.1.1. LEDs<a href="#311-leds" class="hash-link" aria-label="Direct link to 3.1.1. LEDs" title="Direct link to 3.1.1. LEDs">‚Äã</a></h4>
<p>LEDs - Light Emitting Diodes - emit light when they are forward biased. Do not confuse them with traditional light bulbs, as they operate in fundamentally different ways.</p>
<p>Depending on the semiconductors used in their construction and the plastic lens that acts as a dispersion lens and optical filter, LEDs can emit light in different colors. Do not confuse LEDs with bulbs! While light bulbs emit light by heating a tungsten filament to high temperatures, LEDs emit light by passing current through a semiconductor material (p-n junction). Unlike bulbs, which have an efficiency of less than 5% (most of the energy is lost as heat), LEDs have a much higher efficiency in converting electrical energy into light.</p>
<p>LEDs can be used as status indicators (often used in various devices to signal that a device is on and performing a function) or for illumination, where high-power LEDs are used. In the laboratory, LEDs are used to indicate the state of a pin.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="current-limiting-resistor-calculation">Current Limiting Resistor Calculation<a href="#current-limiting-resistor-calculation" class="hash-link" aria-label="Direct link to Current Limiting Resistor Calculation" title="Direct link to Current Limiting Resistor Calculation">‚Äã</a></h5>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>LEDs are diodes, so the current through them increases exponentially with the applied voltage.</p></div></div>
<p>To use an LED as a status indicator for a pin (more specifically, to indicate the presence of voltage), the current through the LED must be limited. The simplest way to do this is by placing a resistor in series with the LED.</p>
<p>An LED is designed to operate at a nominal current (e.g., 10mA). The voltage drop at this current for low-power indicator LEDs is determined by the LED‚Äôs chemistry (which also determines its color). In the laboratory, because we are using LEDs with such low current requirements, we can power them directly from the logic pins of the ¬µC.</p>
<p>The circuit used is as follows:</p>
<p><img decoding="async" loading="lazy" alt=" Working circuit and calculation of current-limiting resistor" src="/assets/images/r_limit-f5e5fd5b3b2a2a99d50edebba2592626.png" width="995" height="723" class="img_ev3q"></p>
<p><strong>Solution</strong>: If the microcontroller operates at 5V and we want to use a red LED at 10mA, with a voltage drop of 1.7V as specified by the manufacturer, we need to use a 330-ohm resistor.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-buttons">3.1.2. Buttons<a href="#312-buttons" class="hash-link" aria-label="Direct link to 3.1.2. Buttons" title="Direct link to 3.1.2. Buttons">‚Äã</a></h4>
<p>The simplest way for a user to interact with a microcontroller is by using buttons. The correct way to connect a push-button in this laboratory is shown in the diagram below:</p>
<p><img decoding="async" loading="lazy" alt=" Connecting a push-button: a) incorrect, with floating input, b) correct, with pull-up resistor" src="/assets/images/conectare_buton-1cca6542565f3f068e275c3c0a3b49fa.png" width="1920" height="1080" class="img_ev3q"></p>
<p>Connecting a push-button: a) incorrect, with floating input, b) correct, with pull-up resistor</p>
<p><strong>a)</strong> Shows a button connected to pin PD0 of the ¬µC. When the button is pressed, the PD0 input will be connected to GND, meaning it will be in the logic ‚Äú0‚Äù state. This connection method is incorrect because when the button is not pressed, the input is in an <strong>undefined state</strong> (as if left floating), not being connected to either GND or Vcc! This state is called <strong>high impedance state</strong>. In practice, if we were to read the value of the pin now, it could randomly be read as 1 or 0 depending on environmental conditions. For example, if we bring a finger close to the input, the reading might be 1, and if we move it away, the reading might be 0.</p>
<p><strong>b)</strong> Shows the correct way to connect the button, using a <strong>pull-up resistor</strong> between the input pin and Vcc. This resistor ensures that the input remains in the logic ‚Äú1‚Äù state when the button is not pressed by ‚Äúpulling up‚Äù the potential of the line to Vcc. Alternatively, a <strong>pull-down resistor</strong> (connected to GND) can be used, in which case the input is kept in the logic ‚Äú0‚Äù state when the button is not pressed.</p>
<p><strong>In the laboratory</strong>: To save external space, in the ATmega328P ¬µC, these resistors are built into the integrated circuit. Initially, they are disabled and can be activated through software.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-working-with-registers">3.2. Working with Registers<a href="#32-working-with-registers" class="hash-link" aria-label="Direct link to 3.2. Working with Registers" title="Direct link to 3.2. Working with Registers">‚Äã</a></h3>
<p>This can be considered the most important step when using a ¬µC. We must learn how to configure the ¬µC internally so that it performs the functions we desire. In this laboratory, we will configure the pins to function as I/O: some pins will read whether there is voltage on them (input), while others will output 0 volts or 5 volts depending on our software commands.</p>
<p>To clarify the terminology: when we say <strong>we set a register</strong> or write to a register, we are not referring to the general-purpose registers in the processor that you may have worked with in IOCLA. <strong>We are referring to memory addresses</strong> reserved in the ¬µC. Let‚Äôs repeat together: &quot;By register, we mean a memory address.&quot; Practically speaking, how things work &quot;under the hood&quot; is that these bytes have physical connections, and if we write a bit of 1 or 0 in certain positions, we activate or deactivate components in the ¬µC.</p>
<p>Whenever you need to configure a peripheral, the best source to find the exact settings and their functions is always the <a href="http://www.microchip.com/downloads/en/DeviceDoc/Atmel-42743-ATmega324P_Datasheet.pdf" target="_blank" rel="noopener noreferrer">datasheet</a> of the ¬µC. Since it is not convenient to write in code like <code>*(0x04) = 0b0000 0001</code>, ¬µC manufacturers provide libraries (<a href="https://www.nongnu.org/avr-libc/user-manual/modules.html" target="_blank" rel="noopener noreferrer">avr-libc</a>) that give names to these addresses. The following cheat sheet shows how to configure a specific bit at a certain address using macros (which are considered best practice).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>To write a value into a register, you can assign a value directly; however, this method does not make the code very easy to understand. <em>Our recommendation</em> is to use bit masks (<code>(1 &lt;&lt; x)</code>) or the <code>_BV(x)</code> macro. We also recommend using the pin name instead of its index, as the names are indicative of their function (for example, in the <code>ADCSRA</code> register of the analog-to-digital converter, the <code>ADEN</code> bit is the enable bit). The pin names, like the registers, are already defined in avr-libc.</p></div></div>
<hr>
<table><thead><tr><th>Operation</th><th>Syntax</th></tr></thead><tbody><tr><td>Set bit to 1</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro |= (1 &lt;&lt; bit_index)
</code></td></tr><tr><td>Set bit to 0</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro &amp;= ~(1 &lt;&lt; bit_index)
</code></td></tr><tr><td>Toggle bit</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro ^= (1 &lt;&lt; bit_index)
</code></td></tr><tr><td>Read bit</td><td><code style="background-color:#f5f5f5;padding:2px 4px;border-radius:4px">
macro &amp; (1 &lt;&lt; bit_index)
</code></td></tr></tbody></table>
<p>Example: Working with registers</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">// NOT RECOMMENDED.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Also not recommended, as it hardcodes the pin index.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> PB3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// RECOMMENDED.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DDRB </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_BV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PB3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// RECOMMENDED.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For more details about working with bits in registers, refer to the tutorial section on the <a href="https://ocw.cs.pub.ro/courses/pm/tutorial/biti" target="_blank" rel="noopener noreferrer">wiki</a>.</p>
<p>Don&#x27;t worry, we will have plenty of lab sessions to get used to working with registers and configuring the ¬µC. We encourage you to put in some effort now at the beginning for an easier journey throughout the semester.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-io-registers">3.3. I/O Registers<a href="#33-io-registers" class="hash-link" aria-label="Direct link to 3.3. I/O Registers" title="Direct link to 3.3. I/O Registers">‚Äã</a></h3>
<p>For this lab, we have spared you from searching through the datasheet, which can seem complicated at first, and have summarized the memory addresses (registers) you need to modify to complete this lab.</p>
<p>The ATmega324 microcontroller offers 4 I/O ports, each with 8 pins. Internally, each port has three 8-bit registers that allow the user to control <em>data flow at the pin level</em>: you can write/read data to/from the respective port. These three registers are:</p>
<ul>
<li><strong><code>DDRn</code></strong> - <em>Data Direction Register</em>
<ul>
<li>Sets the direction of the port pins</li>
<li>If bit <em>x</em> is <strong>0</strong>, pin <em>x</em> is <strong>input</strong></li>
<li>If bit <em>x</em> is <strong>1</strong>, pin <em>x</em> is <strong>output</strong></li>
</ul>
</li>
<li><strong><code>PORTn</code></strong> - <em>Data Register</em>
<ul>
<li>Sets the output values of the pins or enables/disables pull-up resistors</li>
<li>If bit <em>x</em> is <strong>0</strong>:<!-- -->
<ul>
<li>If pin <em>x</em> is <strong>output</strong>, it will be <strong>LOW</strong></li>
<li>If pin <em>x</em> is <strong>input</strong>, the pull-up resistor will be <strong>disabled</strong></li>
</ul>
</li>
<li>If bit <em>x</em> is <strong>1</strong>:<!-- -->
<ul>
<li>If pin <em>x</em> is <strong>output</strong>, it will be <strong>HIGH</strong></li>
<li>If pin <em>x</em> is <strong>input</strong>, the pull-up resistor will be <strong>enabled</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>PINn</code></strong> - <em>Input Pins Address</em>
<ul>
<li>If the pin is <strong>input</strong>, we can read data from the respective port<!-- -->
<ul>
<li>If pin <em>x</em> is <strong>LOW</strong>, then bit <em>x</em> will be <strong>0</strong></li>
<li>If pin <em>x</em> is <strong>HIGH</strong>, then bit <em>x</em> will be <strong>1</strong></li>
</ul>
</li>
<li>If the pin is <strong>output</strong>, we can toggle it automatically<!-- -->
<ul>
<li>If we write <strong>1</strong> to bit <em>x</em>, the corresponding bit in <code>PORTn</code> will automatically be inverted (<strong>toggle</strong> function)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><em>n</em> can be A, B, C, or D, depending on the selected port. <em>x</em> can be between 0 and 7.</p>
<p>A detailed description of the ports and their corresponding registers can be found in the ATmega324 datasheet, in the <em>I/O Ports</em> chapter.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="331-example-of-output-handling">3.3.1. Example of Output Handling<a href="#331-example-of-output-handling" class="hash-link" aria-label="Direct link to 3.3.1. Example of Output Handling" title="Direct link to 3.3.1. Example of Output Handling">‚Äã</a></h4>
<p>Let&#x27;s assume we have an LED connected to pin 1 of port B (called <code>PORTB1</code> or <code>PB1</code>). To turn the LED on or off, follow these steps:</p>
<ul>
<li>Configure pin <code>PB1</code> as an output:<!-- -->
<ul>
<li>Bit 1 (<code>PB1</code>) in the <code>DDRB</code> register should be set to 1</li>
<li><code>DDRB |= (1 &lt;&lt; PB1);</code></li>
</ul>
</li>
<li>To turn the LED on, set pin <code>PB1</code> to HIGH:<!-- -->
<ul>
<li>Bit 1 (<code>PB1</code>) in the <code>PORTB</code> register should be set to 1</li>
<li><code>PORTB |= (1 &lt;&lt; PB1);</code></li>
</ul>
</li>
<li>To turn the LED off, set pin <code>PB1</code> to LOW:<!-- -->
<ul>
<li>Bit 1 (<code>PB1</code>) in the <code>PORTB</code> register should be set to 0</li>
<li><code>PORTB &amp;= ~(1 &lt;&lt; PB1);</code></li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="332-example-of-input-handling">3.3.2. Example of Input Handling<a href="#332-example-of-input-handling" class="hash-link" aria-label="Direct link to 3.3.2. Example of Input Handling" title="Direct link to 3.3.2. Example of Input Handling">‚Äã</a></h4>
<p>Let&#x27;s assume we have a button connected to pin 4 of port D (called <code>PORTD4</code> or <code>PD4</code>), using the correct connection from case <strong>b)</strong> shown earlier. To determine the button&#x27;s state (pressed or released), follow these steps:</p>
<ul>
<li>Configure pin <code>PD4</code> as an input:<!-- -->
<ul>
<li>Bit 4 (<code>PD4</code>) in the <code>DDRD</code> register should be set to 0</li>
<li><code>DDRD &amp;= ~(1 &lt;&lt; PD4);</code></li>
</ul>
</li>
<li>To determine whether the button is pressed, read the value of the pin it is attached to. It will be 1 when the button is released and 0 when the button is pressed:<!-- -->
<ul>
<li>Read bit 4 (<code>PD4</code>) in the <code>PIND</code> register:</li>
<li><code>char val = PIND &amp; (1 &lt;&lt; PD4);</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-developing-programs-for-avr">4. Developing Programs for AVR<a href="#4-developing-programs-for-avr" class="hash-link" aria-label="Direct link to 4. Developing Programs for AVR" title="Direct link to 4. Developing Programs for AVR">‚Äã</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Development and Compilation without PlatformIO</summary><div><div class="collapsibleContent_i85q"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-development-and-compilation">4.1. Development and Compilation<a href="#41-development-and-compilation" class="hash-link" aria-label="Direct link to 4.1. Development and Compilation" title="Direct link to 4.1. Development and Compilation">‚Äã</a></h3><p>For program development, we can use any text editor.</p><p>In the labs, we will write C code, not assembly (AVRASM), using the <a href="https://gcc.gnu.org/wiki/avr-gcc" target="_blank" rel="noopener noreferrer">avr-gcc</a> compiler. This can be used on both Linux/Unix and Windows (<a href="http://winavr.sourceforge.net/" target="_blank" rel="noopener noreferrer">WinAVR</a>). WinAVR includes the C library, avr-libc, which must be installed separately on Linux/Unix systems.</p><p><img decoding="async" loading="lazy" alt="Compilation Process with AVR-GCC" src="/assets/images/procesul_de_compilare-81b7f35e0e3f478577e22db2b3ac9452.jpg" width="834" height="303" class="img_ev3q"></p><p>Although our microcontroller is 8-bit, in C code, we can use integer variables of 16/32/64 bits and even floating-point numbers. The compiler handles translating instructions into assembly code that operates on 8-bit architecture.</p><p>As with Linux systems, to program AVR, we need some utilities: the avr-gcc compiler, avr-libc, and AVRDUDE. To install these utilities, Homebrew is recommended. Use the following commands:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install avrdude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xcode-select --install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew tap osx-cross/avr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install avr-gcc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To run on M1/M2/M3 processors, you need to install at least version 11 of avr-gcc.
More examples can be found <a href="https://wellys.com/posts/avr_c_macos/" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-programming-the-microcontroller">4.2. Programming the Microcontroller<a href="#42-programming-the-microcontroller" class="hash-link" aria-label="Direct link to 4.2. Programming the Microcontroller" title="Direct link to 4.2. Programming the Microcontroller">‚Äã</a></h3><p>A microcontroller can be programmed using various methods, such as serial interface programming, an ISP programmer (In-System Programming) using the SPI interface, or a bootloader.</p><p>In this lab, we will use the last method because it eliminates the need for additional external components to upload the hex file. A <strong>bootloader</strong> is a program preloaded (using, for example, an ISP programmer) at the end of the microcontroller&#x27;s program memory. Execution of uploaded code will start from the boot section. The drawback of this method is the memory space occupied by the bootloader.</p><p><img decoding="async" loading="lazy" alt="Executing Programs Using a Bootloader" src="/assets/images/avr_bootloader_model-4d2cf809b45926c332eacfb42a34c4e3.jpg" width="392" height="338" class="img_ev3q"></p><p>Using a bootloader requires meeting a condition at the microcontroller‚Äôs startup. On lab boards, it runs on each RESET, but we can set any condition detectable by the processor (for example, whether a button is pressed or not). Some microcontrollers have a dedicated ROM for the bootloader, factory-installed (e.g., STM32).</p><p>To upload the program to the microcontroller, we must use a utility on the computer. Below is an example of using the <strong>avrdude</strong> utility on Linux and Windows:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ avrdude </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">c arduino </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dev</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ttyUSB0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">57600</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p atmega324p </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">U flash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">w</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">lab0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> avrdude </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">c arduino </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P COM12 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">57600</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p atmega324p </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">U flash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">w</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">lab0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-platformio">4.3. PlatformIO<a href="#43-platformio" class="hash-link" aria-label="Direct link to 4.3. PlatformIO" title="Direct link to 4.3. PlatformIO">‚Äã</a></h3>
<p>For an all-in-one <strong>toolchain and IDE</strong> solution, install <a href="https://platformio.org/" target="_blank" rel="noopener noreferrer">PlatformIO</a>. After installing the PlatformIO extension in VSCode, create a new project targeting ATmega324P as the platform/microcontroller and add the following line to <strong>platformio.ini</strong>:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> upload_protocol </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> urclock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>PlatformIO alternative</summary><div><div class="collapsibleContent_i85q"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="431-alternative-to-platformio-installing-the-avr-gcc-toolchain-separately">4.3.1 Alternative to PlatformIO: Installing the avr-gcc Toolchain Separately<a href="#431-alternative-to-platformio-installing-the-avr-gcc-toolchain-separately" class="hash-link" aria-label="Direct link to 4.3.1 Alternative to PlatformIO: Installing the avr-gcc Toolchain Separately" title="Direct link to 4.3.1 Alternative to PlatformIO: Installing the avr-gcc Toolchain Separately">‚Äã</a></h4><p>Alright, so you&#x27;re a hardcore software developer and want to install the toolchain directly using your favorite IDE (who am I kidding, you&#x27;re working directly in Vim). You have that option too, but it comes with a few headaches. If you want to install just the toolchain, without an IDE, you will need <strong>avr-gcc</strong>, <strong>make</strong>, and <strong>avrdude</strong> to compile and program the development board. We recommend the following installation guides:</p><ul>
<li><a href="https://baremetalmicro.com/tutorial_avr_toolchain/03-Install-on-Ubuntu-Linux.html" target="_blank" rel="noopener noreferrer"> Linux</a></li>
<li><a href="https://tinusaur.com/guides/avr-gcc-toolchain/" target="_blank" rel="noopener noreferrer"> Windows</a></li>
<li><a href="https://wellys.com/posts/avr_c_macos/" target="_blank" rel="noopener noreferrer"> Mac</a></li>
</ul><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>It is possible that the default installation of avrdude does not support the <strong>urclock</strong> bootloader on the board, and you may receive an error message when running <strong>make upload</strong>. To fix this issue, you need to install avrdude 7.2-arduino.1 (or install PlatformIO directly, which comes with the correct version of avrdude).</p></div></div><p>We also recommend using an IDE for code development. If you prefer VSCode (without the PlatformIO extension), check out this <a href="https://www.youtube.com/watch?v=LE7-uzhlGVM&amp;ab_channel=WhiteHeart" target="_blank" rel="noopener noreferrer">tutorial</a>.</p><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>Warning</strong>: Support for the <code>urclock</code> programmer (also known as <code>urprotocol</code>), used by our boards, <a href="https://github.com/avrdudes/avrdude/blob/main/NEWS" target="_blank" rel="noopener noreferrer">was only added</a> in <code>avrdude &gt;= 7.1</code>. Make sure you install a recent version (e.g., <strong>7.3</strong>)! Notably, Ubuntu 22.04 only provides version 6.3: <a href="https://github.com/avrdudes/avrdude/releases" target="_blank" rel="noopener noreferrer">download the precompiled version from GitHub</a> or use PlatformIO if you do not meet this minimum version requirement! Of course, if you download the binary manually, don&#x27;t forget to make it executable and place it somewhere in your PATH (e.g., <code>/usr/local/bin/</code> on Linux or <code>C:\Windows\System32</code> on Windows, plus manually copying <code>avrdude.conf</code> if needed).</p></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-hello-world">4.4. Hello World<a href="#44-hello-world" class="hash-link" aria-label="Direct link to 4.4. Hello World" title="Direct link to 4.4. Hello World">‚Äã</a></h3>
<p>We will write a program that turns an LED on and off at 500 ms intervals. The targeted LED is the green one on the laboratory board. This is done by modifying the voltage of one of the microcontroller&#x27;s pins, in our case, pin 7 of port D (<code>PD7</code>).</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;avr/io.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;util/delay.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Set pin 7 of port D as an output. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DDRD </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> PD7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Toggle the state of the pin. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PORTD </span><span class="token operator" style="color:#393A34">^=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> PD7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_delay_ms</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To compile with PlatformIO, press <strong>Ctrl+Alt+B</strong>, then <strong>Ctrl+Alt+U</strong> to upload.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Using a Custom Makefile for Compilation </summary><div><div class="collapsibleContent_i85q"><p>If you have installed the toolchain separately, you need to use the following Makefile:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">Linux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PORT </span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dev</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ttyUSB0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">Windows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property expression" style="color:#36acaa">PORT </span><span class="token macro property expression operator" style="color:#393A34">?</span><span class="token macro property expression operator" style="color:#393A34">=</span><span class="token macro property expression" style="color:#36acaa"> COM1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avr</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">objcopy  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">j </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">j </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">O ihex $</span><span class="token operator" style="color:#393A34">^</span><span class="token plain"> $@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avr</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">size main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elf</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avr</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">gcc </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mmcu</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">atmega324p </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">DF_CPU</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">12000000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Os </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Wall </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o $@ $</span><span class="token operator" style="color:#393A34">^</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upload</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	avrdude </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">c urclock </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P $</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">57600</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p atmega324p </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">D </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">xnometadata </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">U flash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">w</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">$</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rf main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elf main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hex</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The compiler used is <strong>avr-gcc</strong>. The flags have the following meanings:</p><ul>
<li><code>-mmcu</code>: Informs the compiler about the type of microcontroller for which the code should be generated.</li>
<li><code>-DF_CPU=12000000</code>: Defines the macro <code>F_CPU</code>, which indicates the clock frequency of the microcontroller.</li>
<li><code>-Os</code>: Optimizes the program for memory usage (quite useful given the limited memory on the chip).</li>
<li><code>-Wall</code>: Enables all warning messages.</li>
</ul><p>The file to be programmed onto the board must be in <em>ihex</em> format. Therefore, it is necessary to extract the data and code sections from the compiled ELF file and integrate them into an <em>ihex</em> file. This step is performed using the <strong>avr-objcopy</strong> utility.</p><p>The <strong>avr-size</strong> command shows how much memory different sections of the program occupy. Keep in mind that in the SRAM memory for data, besides the <code>.data</code> section, the stack will also be placed. To run the program on the ATmega324microcontroller, the <code>.text</code> section must be smaller than 32 KB, and the <code>.data</code> section must be smaller than 2 KB.</p></div></div><p>The result of the compilation is the <strong>main.hex</strong> file. This file is then uploaded to the microcontroller using the <strong>upload</strong> rule.</p></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-exercises">5. Exercises<a href="#5-exercises" class="hash-link" aria-label="Direct link to 5. Exercises" title="Direct link to 5. Exercises">‚Äã</a></h2>
<p><strong>Task 0</strong> Let&#x27;s start by verifying the setup.</p>
<ul>
<li>Install your preferred/required IDE and run the Hello World example on the development board in the lab.</li>
</ul>
<p><strong>Task 1</strong></p>
<ul>
<li>
<p>Modify the Hello World example so that the lit LED is red instead of green. Hint: Find the pin and port to which this LED (part of the RGB LED) is connected in the <a href="https://raw.githubusercontent.com/dantudose/PM-Board/main/Hardware/schematic.pdf" target="_blank" rel="noopener noreferrer">board schematic</a> / <a href="https://github.com/dantudose/PM-Board/tree/main?tab=readme-ov-file#board-pinout" target="_blank" rel="noopener noreferrer">board documentation on GitHub</a>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The RGB LED has a common anode, so writing a logical 1 to the corresponding GPIO pin will turn off the LED.</p></div></div>
</li>
</ul>
<p><strong>Task 2</strong></p>
<ul>
<li>Modify the Hello World example so that the LED changes color when Button 1 (PB2) is pressed.<!-- -->
<ul>
<li>Keep the green LED on by default.</li>
<li>Configure the registers to set PB2 as an input.</li>
<li>Configure the LED to add another color (red/blue) when the button is pressed. (Don&#x27;t forget to enable the internal pull-up resistor of the ¬µC for PB2.)</li>
</ul>
</li>
</ul>
<p><strong>Task 3</strong></p>
<ul>
<li>Starting from the application created in Task 2, change the functionality of Button 1 to cycle through LED colors on successive presses (first press - red, second press - green, third press - blue, and so on).</li>
<li>Use Button 2 to toggle between a blinking (flashing) LED and a solid-on state (one press - blinking, second press - always on, next press - blinking again, etc.).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-useful-links">6. Useful Links<a href="#6-useful-links" class="hash-link" aria-label="Direct link to 6. Useful Links" title="Direct link to 6. Useful Links">‚Äã</a></h2>
<ul>
<li><a href="http://www.avrfreaks.net/" target="_blank" rel="noopener noreferrer">AVR Freaks Community</a></li>
<li><a href="http://www.nongnu.org/avr-libc/user-manual/modules.html" target="_blank" rel="noopener noreferrer">AVR libc Documentation</a></li>
<li><a href="https://gcc.gnu.org/wiki/avr-gcc" target="_blank" rel="noopener noreferrer">AVR GCC Compiler</a></li>
<li><a href="http://hackaday.com/2010/10/23/avr-programming-introduction/" target="_blank" rel="noopener noreferrer">Introductory Details on AVR Programming (Blog)</a></li>
<li><a href="http://electronics.howstuffworks.com/led.htm" target="_blank" rel="noopener noreferrer">How LEDs Work</a></li>
<li><a href="https://raw.githubusercontent.com/dantudose/PM-Board/main/Hardware/schematic.pdf" target="_blank" rel="noopener noreferrer">PM Development Board Schematic</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/lab"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">General Lab Rules</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/lab/lab01"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Laboratory 1: USART. Debugging</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-introduction" class="table-of-contents__link toc-highlight">1. Introduction</a><ul><li><a href="#11-why" class="table-of-contents__link toc-highlight">1.1. Why?</a></li><li><a href="#12-what-is-a-microcontroller-¬µc" class="table-of-contents__link toc-highlight">1.2. What is a microcontroller (¬µC)?</a></li><li><a href="#13-¬µc-in-the-wild" class="table-of-contents__link toc-highlight">1.3. ¬µC in the Wild</a></li><li><a href="#14-whats-inside-a-¬µc" class="table-of-contents__link toc-highlight">1.4. What‚Äôs Inside a ¬µC?</a></li></ul></li><li><a href="#2-microchip-atmel-avr" class="table-of-contents__link toc-highlight">2. Microchip (Atmel) AVR</a><ul><li><a href="#21-atmega324p" class="table-of-contents__link toc-highlight">2.1. ATmega324P</a></li><li><a href="#22-laboratory-board" class="table-of-contents__link toc-highlight">2.2. Laboratory Board</a></li><li><a href="#23-development-board-pinout" class="table-of-contents__link toc-highlight">2.3. Development Board Pinout</a></li></ul></li><li><a href="#3-lets-get-to-work" class="table-of-contents__link toc-highlight">3. Let&#39;s get to work</a><ul><li><a href="#31-actuators-and-transducers-sensors" class="table-of-contents__link toc-highlight">3.1. Actuators and Transducers (Sensors)</a></li><li><a href="#32-working-with-registers" class="table-of-contents__link toc-highlight">3.2. Working with Registers</a></li><li><a href="#33-io-registers" class="table-of-contents__link toc-highlight">3.3. I/O Registers</a></li></ul></li><li><a href="#4-developing-programs-for-avr" class="table-of-contents__link toc-highlight">4. Developing Programs for AVR</a><ul><li><a href="#41-development-and-compilation" class="table-of-contents__link toc-highlight">4.1. Development and Compilation</a></li><li><a href="#42-programming-the-microcontroller" class="table-of-contents__link toc-highlight">4.2. Programming the Microcontroller</a></li><li><a href="#43-platformio" class="table-of-contents__link toc-highlight">4.3. PlatformIO</a></li><li><a href="#44-hello-world" class="table-of-contents__link toc-highlight">4.4. Hello World</a></li></ul></li><li><a href="#5-exercises" class="table-of-contents__link toc-highlight">5. Exercises</a></li><li><a href="#6-useful-links" class="table-of-contents__link toc-highlight">6. Useful Links</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/pm" target="_blank" rel="noopener noreferrer" class="footer__link-item">UPB Open CourseWare <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 Politehnica Bucharest. <br> This pages are the translated and adapted version from https://ocw.cs.pub.ro/courses/pm</div></div></div></footer></div>
</body>
</html>